  江西伺泰威自动化设备有限公司

rev2.2

GIM6010-8 微电机使用说明书

目录

1  电机规格参数 ........................................................................................................................................ 5

1.1  图纸及尺寸 ................................................................................................................................................. 5

1.2  电气特性 ...................................................................................................................................................... 6

1.3  机械特性 ...................................................................................................................................................... 6

2  驱动器信息 ............................................................................................................................................ 8

2.1  外观及三维尺寸 ........................................................................................................................................ 8

2.2  接口概览 ...................................................................................................................................................... 9

2.3  规格 ............................................................................................................................................................... 9

2.4  接口详细定义 .......................................................................................................................................... 10

2.5  主要器件及规格 ..................................................................................................................................... 14

3  调测说明 ............................................................................................................................................. 15

3.1  上手指南 ................................................................................................................................................... 15

3.2  固件更新下载 .......................................................................................................................................... 39

4  通信协议及示例 ................................................................................................................................. 41

4.1

4.2

4.3

4.4

CAN SIMPLE 协议 ..................................................................................................................................... 41

CANOPEN 协议 ........................................................................................................................................ 54

RS485 协议（MODBUS RTU） ............................................................................................................ 56

PWM 输入控制 ....................................................................................................................................... 81

4.5  脉冲/方向控制 ........................................................................................................................................ 83

4.6

SDK ............................................................................................................................................................. 85

5  常见问题和异常码（待更新） ........................................................................................................ 95

5.6  常见问题（FAQ） ................................................................................................................................. 95

5.7  异常码 ........................................................................................................................................................ 95

1

  江西伺泰威自动化设备有限公司

rev2.2

版本记录

版本号

日期

修订/说明

0.1

0.2

0.3

0.4

0.5

0.6

0.7

0.8

0.9

0.91

0.92

1.0

1.1

1.2

1.3

1.4

1.5

1.6

1.7

1.8

1.9

2.0

2.1

2.2

2023.12.5

支持 odrivetool 的第一版

2023.12.15

增加指令列表与指令分类

2023.12.19

增加 Python，Arduino，ROS SDK

2023.12.23

增加 USB 和 CAN 兼容性的切换描述

2023.12.29

增加上位机调测实战案例

2024.1.2

2024.1.8

增加 CAN 协议和 Python 调测实战案例

增加 CAN 接口 120R 匹配电阻开关选项

2024.2.15

增加第二编码器相关内容及用户零点设置

2024.2.23

增加可修改参数和调用接口函数的 CAN 指令

2024.3.12

增加国民下载软件的驱动下载地址

2024.3.22

增加 CAN 默认波特率的说明，以及第二编码器作用

下的转子初始位置范围说明。

2024.3.26

增加电机温度保护说明

2024.5.20

增加调测上手指南

2024.5.24

修正 CAN MIT 协议的错误

2024.7.2

增加错误码表

2024.8.18

增加修改 ID 的操作说明

2024.8.21

增加刹车电阻的使用说明

2024.8.31

增加不同版本的 endpoints.json 文件下载地址

2024.9.5

增加 CANOpen 协议说明

2024.10.8

归整异常类型，并增加编码器异常码列表

2024.10.15

增加上位机“电机精灵”的操作说明

2024.12.6

增加 Modbus RTU 协议说明及 C/C++ SDK

2025.1.23

增加 Modbus 随机端点访问描述

2025.5.20

增加 PWM 控制和脉冲方向控制的描述

2

  江西伺泰威自动化设备有限公司

rev2.2

注意事项

1.  请按照本说明书的工作参数使用，否则将会对产品造成不可逆的损坏！

2.  在电机运行过程中，请做好电源的过流过压保护措施，以免损坏驱动器。

3.  使用前请检查各部件完好，如发生部件缺失或损坏，请及时联系技术支持。

4.  驱动器没有防反接能力，请在接电源前参照第 2.4.1 节，确保电源正负正确。

5.  驱动器裸露部分，请不要用手碰触，以免静电损坏！

法律声明

在使用本产品前，请务必仔细阅读本手册，按照内容操作本产品。如用户违反说明书内容

使用本产品，造成的任何财产损失、人身伤害事故，本公司不承担任何责任。因本产品由众多

零部件构成，切勿让⼉童接触本产品，以免发生意外事故。为延⻓产品使用寿命，请勿在⾼

温、⾼压环境中使用本产品。本手册在印刷时已尽可能的包含各项功能介绍和使用说明。但由

于产品功能不断完善、设计变更等，仍可能与用户购买的产品有不符之处。

本手册与实际产品在颜⾊、外观等方⾯可能有所偏差，请以实际产品为准。本公司随时可

能对本手册中的印刷错误、不准确的最新信息进行必要的改进和更改，或对程序和/或设备进行

改进，恕不另行通知。此类更改将上传到本手册的新版本中，请联系技术支持获取。所有图⽚

仅供功能说明参考，请以实物为准。

售后政策

本产品售后服务严格依据《中华人民共和国消费者权益保护法》、《中华人民共和国产品

质量法》实行售后服务，服务内容如下：

1.  保修期限及内容

1)  凡在线上渠道下单购买本产品的用户，可在自签收次⽇起七⽇内享受⽆理由退货服

务。退货时用户须出⽰有效购买凭证，并退回发票。用户须保证退货商品保持原有品

质和功能、外观完好、商品本身及配件的商标和各种标识完整⻬全，如有赠品需一并

退回。如果商品出现人为损坏、人为拆机、包装箱缺失、零配件缺失的情况，不予办

理退货。退货时产生的物流费用由用户承担。如果用户未结清物流费用，将按实际发

生额从退款⾦额中扣除。自收到退货商品之⽇起七⽇内向用户返还已支付的货款。退

款方式与付款方式相同。具体到账⽇期可能会受银行、支付机构等因素影响。

2)  自用户签收次⽇起 7 天内，发生⾮人为损坏性能故障，经由本公司售后服务中⼼检测

确认后，为用户办理退货业务，退货时用户须出⽰有效购买凭证，并退回发票。如有

赠品需一并退回。

3)  自用户签收次⽇起 7 天后⾄15 天内，发生⾮人为损坏性能故障，经由本公司售后服

务中⼼检测确认后，为用户办理换货业务，更换整套商品。换货后，商品本身三包期

重新计算。

3

  江西伺泰威自动化设备有限公司

rev2.2

4)  自用户签收次⽇起 15 天后⾄365 天内，经由本公司售后服务中⼼检测确认后，属于

产品本身质量故障，可免费提供维修服务。更换的故障产品归本公司所有。⽆故障产

品，将原样返回。本产品经过各项严格检测后出⼚，如有⾮产品本身质量故障，我们

将有权拒绝用户的退换货需求。

本手册售后政策若与店铺售后政策不一致的，以店铺的售后政策为准。

2.  ⾮保修条例

以下情况不属于保修范围：

1)  超出保修条款所限定的保修期限。

2)  未按照说明书要求，错误使用造成的产品损坏损毁。

3)  不当的操作、维修、安装、改装、测试等不正当使用造成的损坏损毁。

4)  ⾮质量故障引起的常规机械损耗、磨损。

5)  ⾮正常工况下造成的损坏，包括但不限于跌落、撞击、液体浸入、剧烈撞击等。

6)  天灾（如⽔灾、⽕灾、雷击、地震等）或不可抗击力造成的损坏。

7)  超过峰值扭矩使用造成的损坏。

8)  ⾮本公司原装正品或⽆法提供合法购买凭证。

9)  其他⾮产品的设计、技术、制造、质量等问题导致的故障或损坏。

10)  私自拆卸本产品造成的损坏。

如果出现上述情况，用户需自行支付费用。

4

  江西伺泰威自动化设备有限公司

rev2.2

1  电机规格参数

1.1  图纸及尺寸

5

  江西伺泰威自动化设备有限公司

rev2.2

1.2  电气特性

额定转速
最大转速
额定扭矩
堵转扭矩
额定电流
堵转电流
空载电流
绝缘电阻/定子绕组
耐⾼压/定子与机壳
电机反电势
相间电阻
相间电感
转速常数
扭矩常数

特性曲线如下图：

120rpm±10%
420rpm±10%
5N.m
11N.m
10.5A
25A
0.4A
DC 500VAC, 100M Ohms
600 VAC, 1s, 2mA
0.054~0.057Vrms/rpm
0.48Ω±10%
368μH±10%
12.3rpm/v
0.47N.M/A

1.3  机械特性

重量

388g±3

6

极对数
相数
驱动方式
减速⽐

  江西伺泰威自动化设备有限公司
14 对
3 相
FOC
8:1

rev2.2

7

  江西伺泰威自动化设备有限公司

rev2.2

2  驱动器信息

2.1  外观及三维尺寸

8

  江西伺泰威自动化设备有限公司

rev2.2

2.2  接口概览

接口序号

定义

1

2

3

4

5

6

7

15~60V 电源和 CAN 通信集成端子

Type-C 调试接口及上位机通信接口

接口扩展插槽（可扩展 RS485，EtherCAT，航模，脉冲方向，油

门控制等接口/协议）

SWD 调试及下载接口

第二编码器接口（支持 I2C 和 UART）

电机温度接口（NTC）

抱闸/刹车电阻接口，12V 电源，最小/最大限位开关接口

U/V/W

4xM2

三相绕组焊接孔

安装孔

2.3  规格

额定电压

15~48V DC

9

  江西伺泰威自动化设备有限公司

rev2.2

最小/最大电压

12/72V DC

额定电流

最大线电流

最大相电流

待机功耗

CAN 总线最大波特率

Type-C 速率

编码器分辨率

工作环境温度

告警电机温度

告警驱动板温度

6A

30A

120A

<10mA

1Mbps

10Mbps

14bit（单圈绝对值）

-20℃⾄70℃

90℃（可调）

90℃（可调）

2.4  接口详细定义

2.4.1 电源及 CAN 通信/RS485/PWM 端子

板载端子型号 XT30PB(2+2)-M，线端型号 XT30(2+2)-F，品牌⼚家艾迈斯（AMASS）。在

PWM 模式下 CANH 是 PWM 信号输入接口；脉冲模式下 CANH 是脉冲输入信号接口，CANL 是

脉冲方向输入接口。请注意，在支持 RS485 的版本上，CANH/CANL 同时也是 RS485 A/B。

2.4.2 Type-C 调试接口

Type-C 采用标准的数据线规格，常用 PC 或手机 Type-C 数据线均兼容。

2.4.3 接口扩展插槽

此插槽采用下述设计方式，提供丰富的板间扩展接口，可由第三方开发任意的扩展板。请

注意，硬件版本 3.9 以及之后的版本不再提供此扩展接口。

10

  江西伺泰威自动化设备有限公司

rev2.2

第三方可通过 SPI，USART，I2C，PWM，ADC，GPIO 等方式与驱动器进行交互，实现各

种扩展功能。

板载插槽型号是 X0812FVS-20CS-9TV01（母座），扩展板插槽型号是 X0812WVS-20AS-

9TV01（公座），品牌⼚家是星坤。

母座 X0812FVS-20CS-9TV01

公座 X0812WVS-20AS-9TV01

2.4.4 SWD 调试接口

间隔 2mm 的插针孔，用户可焊接 2mm 直插单排针，如下图：

11

  江西伺泰威自动化设备有限公司

rev2.2

2.4.5 第二编码器接口

间隔 2mm 的插针孔，用户可焊接 2mm 直插单排针，请参见 2.4.4。

此接口可通过 USART（TX/RX）或 I2C（SCL/SDA）与第二编码器进行通信。

2.4.6 电机温度接口

电机内置 10K 的 NTC 电阻，两条引线焊接到 MOT_TEMP 和 GND，没有线序。

12

  江西伺泰威自动化设备有限公司

rev2.2

2.4.7 抱闸/刹车电阻接口

图示 5 针接口中上方两个焊孔为抱闸/刹车电阻接口，间隔 2mm 的插针孔，用户可焊接

2mm 直插单排针，请参见 2.4.4。

当为抱闸接口时，驱动器在加电时持续向此接口输出一个电流，以使抱闸呈打开状态，电

机得以正常运转，如驱动器断电，则此电流停止，抱闸锁住，电机将在断电位置锁死。

当为刹车电阻接口时，可外接一个刹车电阻（或称之为泄放电阻），在反电动势⾼于门限

电压时，通过此刹车电阻泄放电流，防止⽆法紧急刹车，或反电动势损坏驱动器。

2.4.8 限位开关接口

驱动器提供两个限位开关接口，且为外部限位开关提供 12V 电源，间隔 2mm 的插针孔，

用户可焊接 2mm 直插单排针，请参见 2.4.4。

其中 LW1 是最小位置限位开关，LW2 是最大位置限位开关。可外接两线式开关或三线式

NPN 开关。

13

  江西伺泰威自动化设备有限公司

rev2.2

2.5  主要器件及规格

序号

1

2

3

4

器件

MCU

驱动芯⽚

型号/规格

N32G455

FD6288Q

磁编码器芯⽚

MA732，14bit 绝对值

MOSFET

JMSH1004NG，100V/120A

数量

1

1

1

6

14

  江西伺泰威自动化设备有限公司

rev2.2

3  调测说明

3.1  上手指南

3.1.1 准备工作

要让电机工作起来，你需要：

✓  电源

请参见第 1 章对于电源电压的要求，推荐用稳压电源或电池。经常用户会疑惑的问题是，

我该怎么选择电源呢？下⾯是一些简单的建议，仅作参考：

选择电源的几个点：
◆  电流需求
一般来说，⾄少要大于 5A。具体的数值取决于系统的功率需求和电压。

◆  电压需求

电压需求取决于两个因素：电机的 Kv 和系统所需的最大转速 RPMmax，所需电源电压
最大值可参考公式：

𝑽𝒎𝒂𝒙 =

𝑹𝑷𝑴𝒎𝒂𝒙
𝑲𝒗

× 𝟏. 𝟐𝟓

其中 1.25 是一个经验系数，给系统一个安全的电压门限。

◆  功率需求

对于功率，简单的说，取决于最⾼转速时的最大电流值 Imax，可参考公式：

𝑷𝒎𝒂𝒙 = 𝑰𝒎𝒂𝒙 ×

𝑹𝑷𝑴𝒎𝒂𝒙
𝑲𝒗

× 𝟏. 𝟐𝟓

✓  电源+通信接口线缆

6010-8 带 2+2 电源通信插座，请联系售后推荐合适的 2+2 线缆。请参考 2.4.1，务必接对

电源正负极，否则会有烧毁驱动器的危险，因为驱动器没有防反接的能力。同时，请注意 2 个

通信线的定义顺序，如 CANH/CANL 的顺序，接错会导致通信不正常。

警告
  请务必避免用手触碰通信总线，避免静电打坏驱动器的接口芯⽚，特别是干燥区域

及干燥季节！

  请务必不要带电拔插电源端子！
  避免使用空开作为电源的开关，有击毁驱动器上电源芯⽚的风险！
  电源电压不要超过 72V！

✓

Type-C 数据线

15

  江西伺泰威自动化设备有限公司

rev2.2

在调测的早期，强烈建议用 USB Type-C 数据线来测试电机。可以使用最常用的手机

Type-C 数据线即可，不可使用仅充电的 Type-C 线。

请注意，Type-C 数据线并不能给驱动器供电，更不能驱动电机转动！

✓  加电

请先关闭电源，连接电源线缆，再打开电源，务必不要带电拔插，或用空开控制单正极或

负极线缆进行开关，这样会导致过大的开机电流烧毁驱动器。

在加电后，可随时插拔 USB Type-C 数据线。

3.1.2 用上位机开始

◆  电机精灵

1.  安装电机精灵（Motor Wizard）

请下载 Windows 下的安装文件

（https://bl.cyberbeast.cn/actuator/steadywin_motorwizard.exe），遵照安装步骤默认过程安装

即可。

2.  安装 USB 驱动

进入网站 https://zadig.akeo.ie 并下载 USB 驱动工具 Zadig，用 Type-C 数据线将驱动器接

入电脑，此时驱动器电源灯亮，打开 Zadig，通过下拉框选择“CyberBeast Motor Driver Device

（Interface 2）”：

通过点击上下键选择不同的 USB 驱动，请为此接口选择“libusb”驱动版本，并点击“Install

Driver”或“Replace Driver”为这个接口安装驱动：

16

  江西伺泰威自动化设备有限公司

rev2.2

◆  odrivetool

驱动器兼容 odrive（https://github.com/odriverobotics/odrive.git），所以使用 odrivetool

作为上位机进行调测。

按照下述步骤安装 odrivetool：

➢  Windows

1.  安装 python

进入 python 官方网站 https://www.python.org 下载最新 python 安装程序并按提示安装。

请不要下载第三方网站或微软 Microsoft Store 商店中的 python 版本。

2.  安装 visual c++生成工具

安装 visual c++生成工具 https://visualstudio.microsoft.com/visual-cpp-build-tools/  ，安装

过程中勾选“使用 C++的桌⾯开发”，如下图所示。

3.  安装 odrivetool

17

  江西伺泰威自动化设备有限公司

rev2.2

使用管理员运行 Windows PowerShell，在其中运行 pip install odrive 并回车安装。如果中

途出错请重试。如果再三出错，请重启电脑再重试。

4.  安装 USB 驱动

进入网站 https://zadig.akeo.ie 并下载 USB 驱动工具 Zadig，用 Type-C 数据线将驱动器接

入电脑，此时驱动器电源灯亮，打开 Zadig，通过下拉框选择“CyberBeast Motor Driver Device

（Interface 2）”：

通过点击上下键选择不同的 USB 驱动，请为此接口选择“WinUSB”驱动版本，并点击“Install

Driver”为这个接口安装驱动：

➢  WSL（Windows Subsystem for Linux）

1)  安装 python/usb/odrivetool

18

  江西伺泰威自动化设备有限公司

rev2.2

如果用户安装了 WSL2，可进入 WSL2 的命令行，按照下⾯的步骤来安装（假设用户 WSL

安装的是 Ubuntu）：

sudo apt install python3 python3-pip

sudo apt install libusb-1.0-0

sudo pip install odrive numpy matplotlib

第一行指令安装 python，第二行指令安装 usb 驱动，第三行指令安装 odrivetool 上位机。

2)  连接驱动器到 WSL

用 type-C 数据线插入 Windows，默认情况下 Windows 会加载此 USB 端口的驱动，而 WSL

并不会加载。需要将此 USB 端口加载到 WSL 中，请参照微软文档

（https://learn.microsoft.com/zh-cn/windows/wsl/connect-usb）操作。

➢  Ubuntu

Ubuntu 下的安装过程跟 WSL 下⾮常类似，请参见上一小节。

3.1.3 合理配置电机参数

警告

建议认真仔细阅读这一节，这是成功运转的关键，且避免把电机烧毁！

按照上一节内容成功安装上位机（电机精灵或 odrivetool）后，电机加电且连接 USB Type-

C 数据线后：

◆  电机精灵

19

  江西伺泰威自动化设备有限公司

rev2.2

打开电机精灵，如果连接成功，如上图左，将会显示电机状态，以及电压；如果没有连接

成功，则⽆法显示正常的电压信息。

点击“电机参数”，在界⾯上方会显示驱动器的硬件版本和固件版本，如上图右，硬件版本

是 3.8.3，固件版本是 0.5.13。

◆  odrivetool

在 shell（Windows PowerShell 或 Linux Terminal）中运行 odrivetool（键入 odrivetool 并回

车），下图显示 Windows 下连接成功（绿⾊字体显示连接信息）：

指令示例：odrv0.axis0.controller.input_vel，odrv0 代表当前连接的电机，默认第一个连接的电

机叫 odrv0，第二个叫 odrv1，以此类推；axis0 代表驱动器连接的第一个电机，目前的版本中

只支持连接一个电机。这个指令的意思是查询驱动器当前速度控制目标值。

操作提示
◆  经常使用 TAB 键，会有指令提示，类似于 linux 下的指令提示，可用上下左右键选

择指令；

◆  上下键会显示历史指令

◆  在指令输入时，会提示历史类似指令，使用右键会直接补全

➢  设置关键门限（limits）

◆  电机精灵

点击电机精灵中的“电机参数”，如下图红框所示，可设置如下关键门限参数：电压范围，

电流门限（最大电流），速度门限（最大速度），以及校准电流。

20

  江西伺泰威自动化设备有限公司

rev2.2

电流门限同时受温度因素的影响，请参考下一小节（odrivetool）中的相关描述。

速度门限通常指速度控制或位置控制模式下的限制，但也可打开在力矩控制下的速度限制

开关。在电机精灵中点击“驱动参数”，可打开此开关，如下图红框：

◆  odrivetool

⚫  电流门限

odrv0.axis0.motor.config.current_lim = 30

上述指令将电流门限设置为 30A。请注意，此电流门限是指 Q 轴电流，而不是电源电流。

这个门限值直接限制了输出扭矩。对于 6010-8，请不要将此门限设置超过 50A！

其他影响电流门限的因素
◆  电机温度
如果使能电机温度保护（odrv0.axis0.motor.motor_thermistor.config.enabled=1），则电
机的当前温度也会影响 Q 轴电流。
◆  驱动板温度
如果使能驱动板温度保护（odrv0.axis0.motor.fet_thermistor.config.enabled=1），则驱
动板的当前温度也会影响 Q 轴电流。

上述两个温度的影响⾮常类似，可以用下述公式表示：

′ =
𝑰𝒍𝒊𝒎

𝑻 − 𝑻𝒍
𝑻𝒖 − 𝑻𝒍

× 𝑰𝒍𝒊𝒎

21

  江西伺泰威自动化设备有限公司

rev2.2

′ 是最终生效的电流门限，𝑰𝒍𝒊𝒎是配置的电流门限，𝑻是当前温度（电机温度或驱

其中𝑰𝒍𝒊𝒎
动板温度），𝑻𝒍是设置的温度下限（motor_thermistor.config.temp_limit_lower 和
fet_thermistor.config.temp_limit_lower），𝑻𝒖是设置的温度上限
（motor_thermistor.temp_limit_upper 和 fet_thermistor.config.temp_limit_upper）。

⚫  速度门限

odrv0.axis0.controller.config.vel_limit = 30

系统全局速度限制，上述指令将其限制为 30turn/s（转/秒）。请注意，默认情况下纯力矩

模式下此速度限制不起作用，但可以打开下述开关来使能：

odrv0.axis0.controller.config.enable_torque_mode_vel_limit = 1

⚫  校准电流

此电流默认是 5A，默认情况下不用修改，但如果用户的电源电流较小，可将此值  减小，

否则在校准时会出现低压告警。

odrv0.axis0.motor.config.calibration_current = 2

➢  设置关键硬件参数

◆  电机精灵

点击电机精灵中的“电机参数”，下图红框展示了一些关键的硬件参数：

这些参数的含义，请参加下一小节（odrivetool）中的描述。

22

  江西伺泰威自动化设备有限公司

rev2.2

◆  odrivetool

⚫  最大放电/充电电流

放电电流是指电源供给驱动器和电机的正向电流，充电电流是指反向流入电源的电流。这

两个值跟电源有关，请设置为一个合适的值，避免电源⽆法放电导致电压被拉低，或者被反电

动势损坏。但请注意，如果将这两个值设置为一个绝对值较小的值，则很容易产生告警。

odrv0.config.dc_max_negative_current

odrv0.config.dc_max_positive_current

⚫  极对数

极对数是电机转子中磁极数量除以 2。用户必须正确设置这个值，才能校准成功，否则将

会有校准告警。

odrv0.axis0.motor.config.pole_pairs

⚫  扭矩常数

扭矩常数是电机产生的扭矩除以 Q 轴电流，它跟电机 Kv 值的关系是：

𝑇𝑜𝑟𝑞𝑢𝑒_𝐶𝑜𝑛𝑠𝑡𝑎𝑛𝑡  = 8.27 𝐾𝑣⁄ 。

odrv0.axis0.motor.config.torque_constant

扭矩常数是否正确并不影响电机的运行，但会影响用户做力矩控制时输入的值的单位换

算，如果用户想用单位 A 而不是 Nm 来进行力矩控制，只需将这个值设为 1 即可。

⚫  温度传感

驱动板和电机内部均带有 NTC 温度传感器，如果使能的话，驱动器会根据温度来控制输出

电流（扭矩），从而对驱动器和电机进行保护。

#  电机温度保护

odrv0.axis0.motor.motor_thermistor.config.enabled = 1

odrv0.axis0.motor.motor_thermistor.config.temp_limit_lower = 20

odrv0.axis0.motor.motor_thermistor.config.temp_limit_upper = 100

#  驱动板温度保护

odrv0.axis0.motor.fet_thermistor.config.enabled = 1

odrv0.axis0.motor.fet_thermistor.config.temp_limit_lower = 20

odrv0.axis0.motor.fet_thermistor.config.temp_limit_upper = 100

#  获取温度

odrv0.axis0.motor.motor_thermistor.temperature #电机温度

odrv0.axis0.motor.fet_thermistor.temperature #驱动板温度

➢  PID 调整

23

  江西伺泰威自动化设备有限公司

rev2.2

下述过程可以为用户调节 PID 参数提供一个参考：

odrv0.axis0.controller.config.pos_gain=20.0

odrv0.axis0.controller.config.vel_gain=0.16

odrv0.axis0.controller.config.vel_integrator_gain=0.32

1.  设置 PID 初始值

2.  将 vel_integrator_gain 调为 0

odrv0.axis0.controller.config.vel_integrator_gain=0

3.  调节 vel_gain 方法：

1)  用速度控制模式转动电机，如果转动不平稳，有抖动或震动，减小 vel_gain，直

到转动平稳

2)  接着，每次把 vel_gain 增大 30%左右，直到出现明显的抖动

3)  此时，将 vel_gain 减小 50%左右，即可稳定

4.  调节 pos_gain 方法：

1)  用位置模式尝试转动电机，如果转动不平稳，有拉动或震动，减小 pos_gain，

直到转动平稳

2)  接着，每次把 pos_gain 增大 30%左右，直到位置控制出现明显的过调（即每次

位置控制电机会超出目标位置，然后振荡回到目标位置）

3)  然后，逐渐减小 pos_gain，直到过调现象消失

5.  在上述 4 步调整过后，可将 vel_integrator_gain 设置为 0.5*bandwidth*vel_gain，其中

bandwidth 是系统控制带宽。何为控制带宽？⽐如，从用户设置目标位置，到电机真

正到达目标位置的时间为 10ms，则控制带宽就是 100Hz，那么

vel_integrator_gain=0.5*100*vel_gain。

在上述调参过程中，建议使用 3.1.8 中的图形化手段实时查看调参效果，避免肉眼感知的误

差。如果使用电机精灵，PID 调整效果“所见即所得”，下图是 PID 参数示意：

24

  江西伺泰威自动化设备有限公司

rev2.2

3.1.4 上电校准

用户第一次使用微电机时，需要对电机以及编码器进行校准。在校准之前，请固定好电

机，或用手握紧，输出轴空载，校准过程如下：

警告

校准前，请将电机空载，并固定好电机！

◆  电机精灵

打开电机精灵，点击“启动电机”，如果电机未校准，则会如下提示：

此时点击“确定”，则会进入校准流程。或者，点击主界⾯的“电机参数”，在“基本参数”中，

会显示电机的校准状态，如果是

状态，则点击状态右侧的“校准”按钮，同样会进入校准

流程。

进入校准流程后，界⾯提示：

25

  江西伺泰威自动化设备有限公司

rev2.2

此时，电机会有一声“嘀”的响声，并开始转动。请观察电机转动情况，如果在经过一定时

间转动后停止，请点击“已停止”结束校准过程；如果没有转动，或超过 5 分钟还会停止，则点

击“取消”。

在结束校准后，驱动器会重启，请稍等 1~3 秒。此时，可再次进入“电机参数”，查看是否

显示

。

◆  odrivetool

odrv0.axis0.requested_state = AXIS_STATE_MOTOR_CALIBRATION

dump_errors(odrv0)

odrv0.axis0.requested_state = AXIS_STATE_ENCODER_OFFSET_CALIBRATION

dump_errors(odrv0)

odrv0.axis0.motor.config.pre_calibrated = 1

odrv0.axis0.encoder.config.pre_calibrated = 1

odrv0.save_configuration()

分步解释如下：

26

  江西伺泰威自动化设备有限公司

rev2.2

➢  第一步：电机参数自识别

测量电机的相电阻和相电感，会听到尖利的“嘀”一声。相电阻和相电感的测量结果可通过

下述指令查看：

odrv0.axis0.motor.config.phase_resistance

odrv0.axis0.motor.config.phase_inductance

➢  第二步：查看错误码

查看第一步过后的系统错误码，如果出现任何的红⾊错误码，则需要重启电机，然后重

试，或者报告售后。

➢  第三步：编码器校准

对编码器进行校准，包括编码器的安装角度与电机机械角度的校准，以及编码器自身的校

准。在这个校准过程中，电机会缓慢正转一个角度，再反转一个角度。如果只正转后就停止，

则说明有错误，请通过第四步查看错误码。

➢  第四步：查看错误码

在第三步编码器校准后，查看系统的错误码。通常出现的错误是

ERROR_CPR_POLEPAIRS_MISMATCH，表示编码器的 CPR 设置错误，或者电机的极对数设置错

误，请通过下述指令查看/设置：

odrv0.axis0.encoder.config.cpr

odrv0.axis0.motor.config.pole_pairs

➢  第五步：写入电机校准成功标志

➢  第六步：写入编码器校准成功标志

➢  第七步：存储校准结果并重启

odrv0.axis0.encoder.config.pre_calibrated = 1

odrv0.axis0.motor.config.pre_calibrated = 1

odrv0.save_configuration()

3.1.5 修改 ID

驱动器 ID 是总线唯一的，范围是 0~63，默认的 ID 为 0。如果用户有多台电机串联在总线

上，则需要给每台电机设置不同的 ID。用户可以通过 USB 或总线方式修改 ID：

➢  电机精灵修改 ID

打开电机精灵，连接上电机后，点击“电机参数”，在“通信参数”一栏中，修改 ID，点击“同

步”存储到驱动器中。

27

  江西伺泰威自动化设备有限公司

rev2.2

➢  USB 修改 ID

用户通过 odrivetool 连接上驱动器后，可通过下述指令修改 ID：

odrv0.axis0.config.can.node_id = xxx

➢  总线修改 ID

请参见 4.1.2 中 Set_Axis_Node_ID 指令消息。

3.1.6 存储和备份参数

在任何参数修改过后，请务必存储，否则所做更改将在断电或重启后失效。存储参数后驱

动器将重启。

odrv0.save_configuration()

参数备份：

odrivetool backup-config "d:/test.json"

其中“d:\test.json”是用户可自由修改的保存路径和文件名。

参数恢复的指令为：

odrivetool restore-config "d:/test.json"

3.1.7 四种控制模式

经历上述准备工作和参数配置过后，就可以尝试控制电机进行不同模式的转动。6010-8 支

持位置控制，速度控制，力矩控制，及运动控制模式。

在位置控制模式中，支持滤波位置控制（Filtered Position Control），梯形曲线位置控制

（Trajectory Control），周期位置控制（Circular Position Control）；

28

  江西伺泰威自动化设备有限公司

rev2.2

在速度控制模式中，支持直接速度控制（Velocity Control），斜坡速度控制（Ramped

Velocity Control）；

在力矩控制模式中，支持直接力矩控制（Torque Control），斜坡力矩控制（Ramped

Torque Control）。

运动控制模式是综合位置，速度和力矩的控制模式，通常用于需要瞬时爆发力强的场景，

如机器人膝关节。行业内也有用户将其称之为 MIT 控制模式，此称呼来源于 MIT 开源机械狗，

因为它采用了这种运动控制模式来控制电机。

在后续对每一种控制模式的详细描述中，此文档中用上位机和 USB 控制指令来做示例，但

同样也可用通信协议（如 CAN）做同样的控制，逻辑是一致的。

如何让电机转起来？
◆  启动电机（进入闭环控制状态）
在所有后续的控制操作中，要让电机转动，都需要让电机进入闭环控制状态。
在电机精灵中，点击“启动电机”既可；在 odrivetool 中指令如下：

odrv0.axis0.requested_state = 8

◆  停止电机（进入空闲状态）

用户需要让电机停止运行，或希望修改参数及保存参数，都需要先让电机进入空闲状
态。
在电机精灵中，点击“停止电机”即可；在 odrivetool 中指令如下：

odrv0.axis0.requested_state = 1

◆  电机精灵

打开电机精灵，可以看到底部四个 TAB 切换，代表四种控制模式，分别是“速度控制”，“力

矩控制”，“位置控制”和“MIT 模式”。

➢  界面基本操作

在启动电机后，表盘会彩⾊⾼亮，几乎所有操作都在表盘上进行：

✓  表盘上单击

当在表盘上单击时，表示控制速度/力矩/位置到当前表盘值。每次单击代表一个控制指

令。用户可以连续多次单击，连续对电机进行控制。

✓  表盘上右击

当在表盘上右击时，在弹出的对话框中，用户可以输入精确目标速度/力矩/位置值，然后

回车以执行控制；在对话框外单击，取消此次控制。

29

  江西伺泰威自动化设备有限公司

rev2.2

✓  表盘上按住拖动

按住表盘并拖动，是进行连续控制，将不断向电机发送速度/力矩/位置控制指令，目标为

当前鼠标的表盘值。

➢  修改驱动参数

点击“驱动参数”，可以调整诸如控制模式、限速、三环增益（带宽）等驱动参数。建议先

停止电机，然后再修改参数并同步。

◆  odrivetool

➢  滤波位置控制（Filtered Position Control）

如果用户希望自己生成位置曲线，然后以一定频率来发送位置控制指令，则建议使用滤波

位置控制，因为这种模式将这些指令平滑的衔接到一起执行。如果这种情况下采用梯形曲线位

置控制，则有可能会让电机转动产生顿挫感或颗粒感。

在这种模式下需要根据发送指令的频率来调整滤波带宽，一个⽐较好的经验是，将带宽设

置为指令频率（单位 Hz）的一半，如以 50Hz 频率发送指令，则：

odrv0.axis0.controller.config.input_filter_bandwidth = 25

使能滤波位置控制：

odrv0.axis0.controller.config.control_mode = 3

odrv0.axis0.controller.config.input_mode = 3

然后进行位置控制：

odrv0.axis0.controller.input_pos = 10 #单位 turns

➢  梯形曲线位置控制（Trajectory Control）

这个模式可以让用户设置加速度，滑行速度和减速度，来控制电机从一个位置平滑移动到

另一个位置。所谓“梯形”是指其速度曲线看起来是梯形，如下图所示，橙⾊是速度，蓝⾊是位

置：

30

  江西伺泰威自动化设备有限公司

rev2.2

可调节的控制参数：

odrv0.axis0.trap_traj.config.vel_limit #滑行速度最大值，单位 turn/s

odrv0.axis0.trap_traj.config.accel_limit #加速度最大值，单位 turn/s^2

odrv0.axis0.trap_traj.config.decel_limit #减速度最大值，单位 turn/s^2

odrv0.axis0.controller.config.inertia #惯量，单位 Nm/(turn/s^2)

请注意，惯量 x 加速度=扭矩，这个值默认为 0。这个值可以改善系统响应，但跟电机的负

载有直接关系。上述四个值均大于等于 0。同时需要注意的是，前⾯提到过的电流门限和速度

门限仍然会在全局起作用，⽐如，上述滑行速度最大值如果设置为⾼于系统级别的 vel_limit，

则起作用的是全局 vel_limit。

要使能梯形曲线控制模式，首先：

odrv0.axis0.controller.config.control_mode = 3

odrv0.axis0.controller.config.input_mode = 5

然后进行位置控制：

odrv0.axis0.controller.input_pos = 10 #单位 turns

➢  周期位置控制（Circular Position Control）

这种模式适用于连续增量位置控制，如机器人轮毂朝一个方向连接转动一段时间，或传送

履带一直运转，如果采用通常的位置控制模式，则目标位置会逐渐增大到一个很大的值，从而

有由于浮点数精度问题而导致定位不准的错误。

使能：

odrv0.axis0.controller.config.circular_setpoints = 1

在这种模式下，每一小步都在单圈内，input_pos 的范围是[0, 1)。如果 input_pos 增加到超

过这个范围，则会被转换为单圈内的值。如果用户希望单步超过单圈，可以设置下述参数为大

于 1 的数：

odrv0.axis0.controller.config.circular_setpoint_range = <N>

➢  直接速度控制（Velocity Control）

这种模式是最简单的速度控制，使能如下：

odrv0.axis0.controller.config.control_mode = 2

odrv0.axis0.controller.config.input_mode = 1

然后输入目标速度来进行控制：

odrv0.axis0.controller.input_vel = 10 #单位 turn/s

31

  江西伺泰威自动化设备有限公司

rev2.2

➢  斜坡速度控制（Ramped Velocity Control）

斜坡速度控制模式是指按照一定斜率来逐步将速度提升到目标值，会⽐上述直接速度控制

更加缓和，使能如下：

odrv0.axis0.controller.config.control_mode = 2

odrv0.axis0.controller.config.input_mode = 2

通过调整斜率来控制加速度：

odrv0.axis0.controller.config.vel_ramp_rate = 0.5 #斜率单位是 turn/s^2

然后输入目标速度来进行控制：

odrv0.axis0.controller.input_vel = 10 #单位 turn/s

➢  直接力矩控制（Toruqe Control）

这是最简单的力矩（电流）控制模式，使能如下：

odrv0.axis0.controller.config.control_mode = 1

odrv0.axis0.controller.config.input_mode = 1

力矩控制的单位是 Nm，而驱动器固件中电流单位是 A，所以还需要设置力矩常数，以让

驱动器能够将 Nm 转换为电流，从而按需求驱动电机输出力矩。

#  力矩常数大约等于8.23 𝐾𝑣⁄
odrv0.axis0.motor.config.torque_constant = 8.23/12.3

然后输入目标速度来进行控制：

odrv0.axis0.controller.input_torque = 1.2 #单位 Nm

另外还需注意的是，如果用户想限制力矩模式下的最大速度，可以打开

enable_torque_mode_vel_limit，并设置 vel_limit，如：

odrv0.axis0.controller.config.enable_torque_mode_vel_limit = 1

odrv0.axis0.controller.config.vel_limit = 30 #单位 turn/s

➢  斜坡力矩控制（Ramped Torque Control）

斜坡力矩控制⾮常类似于斜坡速度控制，使能如下：

odrv0.axis0.controller.config.control_mode = 1

odrv0.axis0.controller.config.input_mode = 6

调整斜率如下：

32

  江西伺泰威自动化设备有限公司

rev2.2

odrv0.axis0.controller.config.torque_ramp_rate = 0.1 #斜率单位是 Nm/s

➢  运动控制（MIT Control）

运动控制模式通过综合控制位置，速度和力矩来控制电机运动到目标位置，可以下述公式

来表示：

𝑇𝑡𝑎𝑟𝑔𝑒𝑡 = 𝐾𝑝 × 𝑃𝑑𝑖𝑓𝑓 + 𝐾𝑑 × 𝑉𝑑𝑖𝑓𝑓 + 𝑇𝑓𝑓

𝑃𝑑𝑖𝑓𝑓 = 𝑃𝑡𝑎𝑟𝑔𝑒𝑡 − 𝑃𝑐𝑢𝑟𝑟𝑒𝑛𝑡

𝑉𝑑𝑖𝑓𝑓 = 𝑉𝑡𝑎𝑟𝑔𝑒𝑡 − 𝑉𝑐𝑢𝑟𝑟𝑒𝑛𝑡

其中𝑇𝑡𝑎𝑟𝑔𝑒𝑡是目标力矩，𝑃𝑑𝑖𝑓𝑓是位置误差，𝑉𝑑𝑖𝑓𝑓是速度误差，𝐾𝑝是位置控制增益，𝐾𝑑是速度控

制增益（或叫阻尼系数），𝑇𝑓𝑓是前馈力矩。

运动控制模式使能如下：

odrv0.axis0.controller.config.control_mode = 3

odrv0.axis0.controller.config.input_mode = 9

调整增益：

odrv0.axis0.controller.input_mit_kp = <float> #位置增益，单位 Nm/turn

odrv0.axis0.controller.input_mit_kd = <float> #阻尼系数，单位 Nm/turn/s
odrv0.axis0.controller.input_pos = 5 #单位 turns

odrv0.axis0.controller.input_vel = 30 #单位 turn/s

odrv0.axis0.controller.input_torque = 2 #单位 Nm

然后通过输入 input_pos，input_vel，input_torque 来进行运动控制：

请注意，在 USB 控制时所输入的位置、速度和扭矩，均是指转子侧，而用 CAN 进行 MIT

控制时，协议中的位置、速度和扭矩均是指输出轴侧，这是为了与 MIT 开源协议保持一致！

3.1.8 进阶

1)  常用指令列表

在连接成功后，用户可通过指令对电机进行控制，并获取电机运行的参数。下表是常用指

令和调测过程及说明：

类型  指令

dump_errors(odrv0)

odrv0.clear_errors()

说明

打印所有的错误信息

清除所有的错误信息

基础

指令

odrv0.save_configuration()

在修改过参数，或电机自动识别参数或校

odrv0.reboot()

odrv0.vbus_voltage

准过后，请务必执行此指令存储修改，否

则断电后丢失所有修改。

重启驱动器

获取电源电压（V）

33

  江西伺泰威自动化设备有限公司

rev2.2

odrv0.ibus

获取电源电流（A）

odrv0.hw_version_major

硬件主版本号，6010-8 目前的主版本号为

3

odrv0.hw_version_minor

硬件次版本号，6010-8 目前的次版本号为

8

odrv0.hw_version_variant

同一硬件配置下的不同型号码，6010-8 对

odrv0.can.config.r120_gpio_num

控制 CAN 接口的 120R 匹配电阻开关的

应的型号码为 1

GPIO 号

odrv0.can.config.enable_r120

控制 CAN 接口的 120R 匹配电阻开关

odrv0.can.config.baud_rate

CAN 的波特率设置

odrv0.config.dc_bus_undervoltage_trip_l

低电压告警门限（V）

evel

odrv0.config.dc_bus_overvoltage_trip_le

超电压告警门限（V）

vel

odrv0.config.dc_max_positive_current

线电流最大值（正值）（A）

odrv0.config.dc_max_negative_current  线电流反向充电最大值（负值）（A）

odrv0.axis0.motor.config.resistance_cali

电机参数识别时最大电压值，一般此值稍

b_max_voltage

小于电源电压一半，如 24V 供电，可设置

为 10

odrv0.axis0.motor.config.calibration_curr

电机参数识别时最大电流值，此值一般可

ent

设置为 2~5A，不可过大，也不可过小。

odrv0.axis0.motor.config.torque_consta

电机的力矩常数（Nm/A）

nt

odrv0.axis0.min_endstop.config

最小（LW1）/最大（LW2）限位开关的配

odrv0.axis0.max_endstop.config

置：

enabled：使能与否

gpio_num：对应的 IO 号，请将最小限位

的 IO 号设置为 1，最大限位的 IO 号设置

为 2

参数

配置

指令

odrv0.axis0.encoder.config.index_offset  用户设置的零点偏移，这个值是用户零点

相对于编码器零点的偏移值。在设置这个

偏移值并保存设置后，所有用户输入的位

置控制目标值均是以此用户零点为基准。

odrv0.axis0.motor.motor_thermistor.con

配置电机温度传感器：

fig

enabled：使能与否

odrv0.axis0.motor.fet_thermistor.config

temp_limit_lower：温度下限

temp_limit_upper：温度上限

odrv0.axis0.motor.motor_thermistor.tem

电机温度

perature

odrv0.axis0.motor.fet_thermistor.temper

驱动器温度

ature

校准

odrv0.axis0.requested_state=4

对电机进行参数识别，包括识别相电阻，

指令

相电感，以及对三相电流平衡性做出校

34

  江西伺泰威自动化设备有限公司

rev2.2

准。这个过程会历时 3~6 秒钟，电机会发

出尖利的声音。在声音停止后，或 6 秒后

没有声音时，均运行 dump_errors(odrv0)

查看错误，确认没有错误再进行其他操

作。

odrv0.axis0.requested_state=7

对编码器进行校准。执行此操作前，请确

认电机输出轴没有任何负载，且用手或其

他装置固定住电机。此操作执行后，电机

会正向和反向旋转一定时间，对编码器进

行识别和校准。在电机停转后，运行

dump_errors(odrv0)查看错误，确认没有

错误再进行其他后续步骤。

odrv0.axis0.encoder.config.pre_calibrate

写入预校准成功，表示不用每次上电进行

d=1

校准。这个参数仅在上述校准成功过后才

能写入，否则写入会失败。

odrv0.axis0.controller.config.load_encod

确保当前操作电机为第 0 个电机。此操作

er_axis=0

仅在 BETA 中必要，量产版本中⽆效。

odrv0.axis0.requested_state=1

停止电机，进入空闲状态

odrv0.axis0.requested_state=8

启动电机，进入闭环状态

odrv0.axis0.motor.config.current_lim

电机运行最大线电流（A），超过此值会

报过流告警。请注意，此值不得大于

100。

odrv0.axis0.controller.config.vel_limit

电机运行最大速度（turn/s），电机转子

速度超过此值会报超速告警。

odrv0.axis0.controller.config.enable_vel_

速度限制开关，为 True 时上述 vel_limit 生

limit

效，为 False 时⽆效。

odrv0.axis0.controller.config.control_mo

控制模式。

de

0：电压控制

1：力矩控制

2：速度控制

3：位置控制

odrv0.axis0.controller.config.input_mod

输入模式。表示用户输入的控制值以什么

e

方式去控制电机运转：

控制

指令

0：闲置

1：直接控制

2：速度斜坡

3：位置滤波

5：梯形曲线

6：力矩斜坡

odrv0.axis0.controller.config.vel_gain

速度环 PID 控制的 P 值

odrv0.axis0.controller.config.vel_integrat

速度环 PID 控制的 I 值

9：运动控制（MIT）

or_gain

odrv0.axis0.controller.input_mit_kp

运动控制（MIT）位置增益

35

  江西伺泰威自动化设备有限公司

rev2.2

odrv0.axis0.controller.input_mit_kd

运动控制（MIT）速度增益（阻尼系数）

odrv0.axis0.controller.config.pos_gain

位置环 PID 控制的 P 值

odrv0.axis0.controller.input_torque

力矩控制的目标，或速度控制/位置控制的

odrv0.axis0.controller.input_vel

速度控制的目标，或位置控制的速度前馈

力矩前馈（Nm）

odrv0.axis0.controller.input_pos

位置控制的目标（turns）

odrv0.axis0.encoder.set_linear_count()  设置编码器的绝对位置，括号中输入 32

（turn/s）

odrv0.axis0.trap_traj.config

包含三个参数：

位整数，此整数绝对值需要小于

odrv0.axis0.encoder.config.cpr

➢

accel_limit：最大加速度

（rev/s^2）

➢  decel_limit：最大减速度

（rev/s^2）

➢

vel_limit：最大速度（rev/s）

这三个参数在

odrv0.axis0.controller.config.input_mode

为梯形曲线的时候起作用，调整位置控制

的加减速效果。

odrv0.axis0.controller.config.

位置滤波带宽，这个参数在

input_filter_bandwidth

odrv0.axis0.controller.config.input_mode

为位置滤波的时候起作用，调节位置控制

的加减速效果。

2)  图形化调测

在对电机进行调测时，如果需要实时监控某些运行参数，可以利用 python 强大的计算库

和图形库，以及 Type-C 接口的⾼速吞吐能力实时输出电机参数。

1.  环境准备

安装计算库和图形库：

pip install numpy matplotlib

2.  图形化参数输出

在 odrivetool 命令行界⾯，调起图形库，读取任何电机运行指标，如：

start_liveplotter(lambda:[odrv0.ibus,odrv0.axis0.encoder.pos_estimate,

odrv0.axis0.controller.input_pos],["ibus","pos","pos_target"])

这个指令将调起一个图形界⾯，实时输出下述三个指标：线电流、位置、目标位置。接下

去，对电机进行位置控制，就会看到电机的实时位置控制曲线：

36

  江西伺泰威自动化设备有限公司

rev2.2

3)  USB和CAN兼容性

在本产品的早期版本（硬件版本小于等于 3.7，可通过下一小节 3.1.8 中的指令

odrv0.hw_version_major 和 odrv0.hw_version_minor 来获取）中，USB 与 CAN 不兼容，可通过

下述方式在两种通信方式中切换（硬件版本大于 3.7 的可忽略本节内容）：

➢  USB 通信时切换到 CAN

当禁止 CAN 时，用户可使用 Type-C 接口通信，此时，可通过下列指令切换到 CAN：

odrv0.config.enable_can_a = True

odrv0.axis0.requested_state = AXIS_STATE_IDLE

odrv0.save_configuration()

➢  CAN 通信时切换到 USB

当使能 CAN 时，用户首先通过发送消息 Set_Axis_State（参数为 1，表示空闲（IDLE）状

态）将电机切换到空闲状态，再通过发送 Disable_Can 消息来切换到 USB（参见 4.1.2）。

请注意，⽆论是从 USB 切换到 CAN，还是 CAN 切换到 USB，必须先让电机处于空闲

（IDLE）状态，否则会切换失败。

4)  CAN匹配电阻开关

37

  江西伺泰威自动化设备有限公司

rev2.2

在驱动器上，已经板载一个 120 欧阻抗匹配电阻，用户可根据需要打开或关闭，指令示例

如下：

odrv0.can.config.r120_gpio_num = 5

odrv0.can.config.enable_r120 = True

5)  用户零点配置

默认情况下，用户从电机读取到的位置，以及做位置控制时的输入值，均是基于驱动器上

的绝对值编码器的零点为基准。但是，在用户场景下，编码器的零点在大多数时候并不是用户

零点，所以用户需要手动设置这个零点偏移。

一般来说，用户可以通过两种手段来定位这个零点，一种手段是通过限位开关，一种手段

是手动设置零点偏移，即用户零点相对于编码器零点的偏移值：

# 用户先手动或者通过位置控制转动到期望的用户零点位置后：

odrv0.axis0.encoder.config.index_offset =

odrv0.axis0.encoder.pos_estimate

6)  限位开关

驱动器支持两个限位开关（LW1 和 LW2），其中 LW1 是最小位置，也是归零位置，LW2

是最大位置。如要使用两个限位开关，请用下述配置：

odrv0.axis0.min_endstop.config.enabled = True

odrv0.axis0.min_endstop.config.gpio_num = 1

odrv0.axis0.max_endstop.config.enabled = True

odrv0.axis0.max_endstop.config.gpio_num = 2

在触发限位开关时，系统将会上报 MIN_ENDSTOP_PRESSED 或 MAX_ENDSTOP_PRESSED

错误，上位机可在此时执行相关的操作。

请注意，硬件版本 3.7 不支持限位开关功能。

7)  刹车电阻

用户可在 2.4.7 中所述的刹车电阻接口（EMG 和 GND）之间接入刹车电阻（也叫泄放电

阻），在母线电流倒灌进电源时，分流消耗瞬时的电流。

用户可通过如下配置使能：

odrv0.config.enable_brake_resistor = True

odrv0.config.brake_resistance = xxx # 设置外接的刹车电阻阻值

odrv0.save_configuration()

如何让驱动器自动泄放呢？可以组合下述两种方式来让控制器自动调整泄放电流：

➢  通过调整最大反向电流

odrv0.config.max_regen_current = xxx # 反向电流最大值，正数

38

  江西伺泰威自动化设备有限公司

rev2.2

当反向电流大于上述设置值时，驱动器会将多余的电流分流到泄放电阻上。

➢  通过调整反电动势电压范围

odrv0.config.enable_dc_bus_overvoltage_ramp = True

odrv0.config.dc_bus_overvoltage_ramp_start = xxx # 分流的电压下限

odrv0.config.dc_bus_overvoltage_ramp_end = xxx # 分流的电压上限

当由于反电动势而产生的电压⾼于上述下限时，驱动器开始分流到泄放电阻，当电压大于

等于上述电压上限时，驱动器将所有电压加于泄放电阻，尝试分流。而电压处于上述下限和上

限之间时，驱动器将按⽐例将电源电压（反电动势电压）加于泄放电阻之上。

请注意，上述两种模式可以同时使能，驱动器会尝试综合两种方式进行泄放。

3.2  固件更新下载

可以通过 SWD 接口（2.4.4）或 Type-C 接口（2.4.2）烧录固件，提供下述三种方式：

3.2.1 国民下载软件

1.  USB（DFU）烧写

请注意，国民下载软件可通过 Type-C 接口进行烧录，也可通过 SWD 接口（仅支持 JLink

和 DAP）烧录，本节主要以 Type-C 接口烧录为例。

首先，下载国民烧录软件的 USB 驱动（https://www.cyberbeast.cn/filedownload/789489）

并安装相应系统的驱动；然后，下载国民烧录软件

（https://cyberbeast.cn/filedownload/766844），解压到任意目录，并且运行。

然后，连接 Type-C 接口，进入 odrivetool，并执行下述指令将驱动器置于 DFU 模式：

odrv0.enter_dfu_mode()

最后，用国民烧录软件进行烧写，如下图所示。请注意，在烧写完成过后，请点击“常用操

作”，然后点击“复位”，可重启驱动器，并可正常通过 odrivetool 连接调测。

39

  江西伺泰威自动化设备有限公司

rev2.2

2.

SWD（JLink 或 DAP）烧写

使用 SWD 方式下载跟 DFU 模式相似，但需要通过 SWD 调试接口（2.4.4）进行连接，且

在上图中选择相应的调试工具（JLink 或 DAP）。

3.2.2 pyocd

pyocd 是 openOCD 的 python 版本，可支持 STLink，JLink，DAP 等通用调试工具进行擦

除、烧写、重置等操作。请注意，必须用 SWD 接口连接驱动器。关于 SWD 的线序，请参见

2.4.4。SWD 接口中有 3.3V 电源，请不要接错线序，以免损毁驱动器！

1.  安装

pip install pyocd

2.  烧写

首先，列出连接的调试工具：

pyocd list

40

  江西伺泰威自动化设备有限公司

rev2.2

然后，执行下述指令烧写 bin 文件：

pyocd load .\ODrive_N32G455.bin -a 0x8000000

4  通信协议及示例

4.1  CAN Simple 协议

默认通信接口是 CAN，最大通信速率 1Mbps（可通过 odrv0.can.config.baud_rate 读取和设

置），出⼚默认速率 500Kbps。请注意：早期硬件版本（小于等于 3.7）中 USB 与 CAN 不兼

容，请参见 3.1.8 中第 3)条，如何从 USB 切换到 CAN。

驱动器默认的协议即为 CAN Simple，如果用户切换到 CANOpen 协议，则需要通过下述指

令切回 CAN Simple：

odrv0.can.config.protocol = 1

请注意，在版本大于等于 3.10 的硬件版本上，通信接口同时支持 RS485，脉冲方向和

PWM。通过下述指令确保通信接口是 CAN：

odrv0.config.comm_intf_mux = 0

在电机精灵中，也可在通信参数中，切换物理接口以及 CAN 协议版本。

4.1.1 协议帧格式

CAN 通信采用标准帧格式，数据帧，11 位 ID，8 字节数据，如下表所示（左为 MSB，右

为 LSB）：

数据域

分段

描述

Bit10 ~ Bit5

node_id

CAN ID（11bits）

Bit4 ~ Bit0

cmd_id

Data（8 bytes）

Byte0 ~ Byte7

通信数据

⚫

node_id：代表这个电机在总线上的唯一 ID，可在 odrivetool 中用

odrv0.axis0.config.can.node_id 来读取和设置。

⚫

cmd_id：指令编码，表示协议的消息类型，请参见本节余下内容。

41

  江西伺泰威自动化设备有限公司

rev2.2

⚫  通信数据：8 个字节，每一个消息中携带的参数会被编码成整数或浮点数，字节序为

小端（little endian），其中浮点数是按照 IEEE 754 标准进行编码（可通过网站

https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

以 4.1.2 中描述的 Set_Input_Pos 消息为例，假设其三个参数分别为：Input_Pos=3.14，

Vel_FF=1000（表示 1rev/s），Torque_FF=5000（表示 5Nm），而 Set_Input_Pos 消息的 CMD

ID=0x00C，假设驱动器的节点（node_id）被设置成 0x05，则：

⚫

11 位 CAN ID=(0x05<<5)+0x0C=0xAC

⚫  根据 4.1.2 中对于 Set_Input_Pos 的描述可知，Input_Pos 在第 0 个字节开始的 4 个字

节，编码为 C3 F5 48 40（浮点数 3.14 用 IEEE 754 标准编码为 32 位数

0x4048f5c3），Vel_FF 在第 4 个字节开始的 2 个字节，编码为 E8 03

（1000=0x03E8），Torque_FF 在第 6 个字节开始的 2 个字节，编码为 88 13

（5000=0x1388），则 8 个字节的通信数据为：

Byte0

Byte1

Byte2

Byte3

Byte4

Byte5

Byte6

Byte7

C3

F5

48

40

E8

03

88

13

4.1.2 帧消息

下表列出了所有的可用消息：

CMD ID  名称

0x001

Heartbeat

方向

电机→主机

0x002

0x003

0x004

0x005

0x006

0x007

0x008

0x009

Estop

Get_Error

RxSdo

TxSdo

Set_Axis_Node_ID

Set_Axis_State

Mit_Control

Get_Encoder_Estimates

主机→电机

电机→主机

电机→主机

电机→主机

主机→电机

主机→电机

主机→电机

电机→主机

参数

Axis_Error

Axis_State

Motor_Flag

Encoder_Flag

Controller_Flag

Traj_Done

Life

Error_Type

Axis_Node_ID

Axis_Requested_State

Pos_Estimate

Vel_Estimate

0x00A

Get_Encoder_Count

电机→主机

Shadow_Count

0x00B

Set_Controller_Mode

主机→电机

0x00C

Set_Input_Pos

主机→电机

42

Count_In_Cpr

Control_Mode

Input_Mode

Input_Pos

  江西伺泰威自动化设备有限公司

rev2.2

0x00D

Set_Input_Vel

主机→电机

0x00E

0x00F

0x010

0x011

0x012

0x013

0x014

0x016

0x017

0x018

0x019

0x01A

0x01B

Set_Input_Torque

Set_Limits

Start_Anticogging

Set_Traj_Vel_Limit

Set_Traj_Accel_Limits

Set_Traj_Inertia

Get_Iq

Reboot

Get_Bus_Voltage_Current

Clear_Errors

Set_Linear_Count

Set_Pos_Gain

Set_Vel_Gains

主机→电机

主机→电机

主机→电机

主机→电机

主机→电机

主机→电机

电机→主机

主机→电机

电机→主机

主机→电机

主机→电机

主机→电机

主机→电机

Vel_FF

Torque_FF

Input_Vel

Torque_FF

Input_Torque

Velocity_Limit

Current_Limit

Traj_Vel_Limit

Traj_Accel_Limit

Traj_Decel_Limit

Traj_Inertia

Iq_Setpoint

Iq_Measured

Bus_Voltage

Bus_Current

Linear_Count

Pos_Gain

Vel_Gain

0x01C

Get_Torques

电机→主机

Torque_Setpoint

Vel_Integrator_Gain

0x01D

Get_Powers

电机→主机

Electrical_Power

Mechanical_Power

0x01E

0x01F

Disable_Can

Save_Configuration

主机→电机

主机→电机

Torque

所有消息的详细描述如下：

➢  Heartbeat

CMD ID: 0x001（电机→主机）

固件版本小于（包含）0.5.11 的⼼跳格式如下：

起始字节  名称

类型  说明

0

4

5

6

Axis_Error

Axis_State

uint32  驱动异常码（odrv0.axis0.error）

uint8  驱动器状态（odrv0.axis0.current_state）

Motor_Flag

uint8

1：电机异常（odrv0.axis0.motor.error 不为 0）

0：电机正常（odrv0.axis0.motor.error 为 0）

Encoder_Flag

uint8

1：编码器异常（odrv0.axis0.encoder.error 不为

0）

43

  江西伺泰威自动化设备有限公司

rev2.2

0：编码器正常（odrv0.axis0.encoder.error 为

0）

7

Controller_Flag

uint8

bit7：odrv0.axis0.controller.trajectory_done，即

位置曲线是否执行完毕

bit0：

1：控制异常（odrv0.axis0.controller.error 不为

0）

0：控制正常（odrv0.axis0.controller.error 为 0）

固件版本大于（包含）0.5.12 的⼼跳格式如下：

起始字节  名称

类型  说明

0

4

5

6

7

Axis_Error

Axis_State

Flags

uint32  驱动异常码（odrv0.axis0.error）

uint8  驱动器状态（odrv0.axis0.current_state）

uint8

bit0：电机异常位（odrv0.axis0.motor.error 是否

为 0）

bit1：编码器异常位（odrv0.axis0.encoder.error

是否为 0）

bit2：控制异常位（odrv0.axis0.controller.error

是否为 0）

bit7：odrv0.axis0.controller.trajectory_done，即

位置曲线是否执行完毕

Reserved

uint8  保留

Life

uint8  周期消息的生命值，每一个⼼跳消息加 1，范围

0-255，如果此生命值不连续，表示⼼跳消息丢

失，即通信不稳。

固件版本大于（包含）0.5.13 的⼼跳格式如下：

起始字节  名称

类型  说明

0

4

5

Axis_Error

Axis_State

Flags

uint32  驱动异常码（odrv0.axis0.error）

uint8  驱动器状态（odrv0.axis0.current_state）

uint8

bit0：电机异常位（odrv0.axis0.motor.error 是否

为 0）

bit1：编码器异常位（odrv0.axis0.encoder.error

是否为 0）

bit2：控制异常位（odrv0.axis0.controller.error

是否为 0）

bit3：系统异常位（odrv0.error 是否为 0）

bit7：odrv0.axis0.controller.trajectory_done，即

位置曲线是否执行完毕

6

Reserved

uint8  保留

44

  江西伺泰威自动化设备有限公司

rev2.2

7

Life

uint8  周期消息的生命值，每一个⼼跳消息加 1，范围

0-255，如果此生命值不连续，表示⼼跳消息丢

失，即通信不稳。

➢

Estop

CMD ID: 0x002（主机→电机）⽆参数⽆数据。

此指令会导致电机紧急停机，并报 ESTOP_REQUESTED 异常。

➢  Get_Error

CMD ID: 0x003（电机→主机）

输入（主机→电机）：

起始字节  名称

0

Error_Type

类型

uint8

说明

0：获取电机异常

1：获取编码器异常

3：获取控制异常

4：获取系统异常

➢  输出（电机→主机）：

起始字节  名称  类型

说明

0

Error

uint32/uint64  不同输入 Error_Type 返回的数据及⻓度：

0：电机异常（odrv0.axis0.motor.error），uint64，8

字节

1：编码器异常（odrv0.axis0.encoder.error），

uint32，4 字节

3：控制异常（odrv0.axis0.controller.error），

uint32，4 字节

4：系统异常（odrv0.error），uint32，4 字节

➢  RxSdo

CMD ID: 0x004（主机→电机）

输入：

起始字节  名称

opcode

0

1

类型

uint8

说明

0：读

1：写

Endpoint_ID

uint16

请下载所有参数和接口函数对应的 ID 的 JSON 文

件：

➢  版本 0.5.13

45

  江西伺泰威自动化设备有限公司

rev2.2

https://bl.cyberbeast.cn/actuator/endpoints_0.5.13.js

on

➢  版本 0.5.14

https://bl.cyberbeast.cn/actuator/endpoints_0.5.14.js

3

4

预留

Value

on

uint8

uint8[4]  根据 Endpoint_ID 不同而不同，可参见上述 JSON 中

的描述。如 Endpoint_ID 对应一个可读写的 float

值，则此处 4 个字节为 IEEE 编码而成的 float 值，

opcode=1 时将此值写入这个 float 值。

输出（当上述 opcode=0 时）：

起始字节  名称

opcode

类型

uint8

说明

固定为 0

Endpoint_ID

uint16

请下载所有参数和接口函数对应的 ID 的 JSON 文

件：

➢  版本 0.5.13

https://bl.cyberbeast.cn/actuator/endpoints_0.5.13.js

on

➢  版本 0.5.14

https://bl.cyberbeast.cn/actuator/endpoints_0.5.14.js

预留

Value

on

uint8

uint8[4]  根据 Endpoint_ID 不同而不同，可参见上述 JSON 中

的描述。如 Endpoint_ID 对应一个可读的 uint32

值，则此处 4 个字节为小端字节序的 uint32。

0

1

3

4

➢

TxSdo

CMD ID: 0x005（电机→主机）

用法跟 opcode=1 时的 RxSdo 一样。

➢

Set_Axis_Node_ID

CMD ID: 0x006（主机→电机）

起始字节  名称

0

Axis_Node_ID

类型

uint32

说明

odrv0.axis0.config.can.node_id

电机在 CAN 总线上的唯一 ID

➢

Set_Axis_State

CMD ID: 0x007（主机→电机）

46

  江西伺泰威自动化设备有限公司

rev2.2

起始字节  名称

类型

说明

0

Axis_Requested_State

uint32

odrv0.axis0.requested_state

➢

➢

➢

➢

➢

➢

0：未定义

1：空闲

3：校准（电机校准+编码器校

准）

4：电机校准

7：编码器校准

8：闭环

➢  Mit_Control

CMD ID: 0x008

这是模拟 MIT 开源运动控制协议（https://github.com/mit-biomimetics/Cheetah-

Software）的实现。

请注意，在 USB 控制时所输入的位置、速度和扭矩，均是指转子侧，而用 CAN 进行 MIT

控制时，协议中的位置、速度和扭矩均是指输出轴侧，这是为了与 MIT 开源协议保持一致！

✓  主机→电机

CAN 数

含义

说明

据帧位

BYTE0

BYTE1

BYTE2

BYTE3

BYTE4

BYTE5

BYTE6

BYTE7

位置：总共 16 位，BYTE0 为⾼ 8 位，

实际位置为 double 型，需要转换为 16

BYTE1 为低 8 位

位 int 型，转换过程为：

输出轴的多圈位置，单位为弧度

pos_int = (pos_double + 12.5)*65535 /

（RAD）

25

速度：总共 12 位，BYTE2 为其⾼ 8

实际速度为 double 型，需要转换为 12

位，BYTE3[7-4]（⾼ 4 位）为其低 4

位 int 型，转换过程为：

位。表示输出轴的角速度，单位为

vel_int = (vel_double + 65) * 4095 / 130

RAD/s

KP 值实际为 double 型，需要转换为 12

KP 值  ：总共 12 位，BYTE3[3-0]（低 4

位 int 型，转换过程为：

位）为其⾼ 4 位，BYTE4 为其低 8 位。

kp_int = kp_double * 4095 / 500

KD 值  ：总共 12 位，BYTE5 为其⾼ 8

KD 值实际为 double 型，需要转换为

位，BYTE6[7-4]（⾼ 4 位）为其低 4

12 位 int 型，转换过程为：

位。

kd_int = kd_double * 4095 / 5

力矩：总共 12 位，BYTE6[3-0]（低 4

实际力矩为 double 型，需要转换为 12

位）为其⾼ 4 位，BYTE7 为其低 8 位。

位 int 型，转换过程为：

单位是 N.m。

t_int = (t_double + 50)* 4095 / 100

转矩常数的单位为 N.m/A

✓  电机→主机

CAN 数

含义

据帧位

说明

47

BYTE0

BYTE1

BYTE2

BYTE3

BYTE4

  江西伺泰威自动化设备有限公司

rev2.2

node id

驱动器 node id

位置：总共 16 位，BYTE1 为⾼ 8 位，

实际位置为 double 型，需要从 16 位

BYTE2 为低 8 位

int 型转换过来，转换过程为：

输出轴的多圈位置，单位为弧度

pos_double = pos_int * 25 / 65535 –

（RAD）

12.5

速度：总共 12 位，BYTE3 为其⾼ 8

实际速度为 double 型，需要从 12 位

位，BYTE4[7-4]（⾼ 4 位）为其低 4

int 型转换过来，转换过程为：

位。表示输出轴的角速度，单位为

vel_double = vel_int * 130 / 4095 – 65

RAD/s

实际力矩为 double 型，需要从 12 位

力矩：总共 12 位，BYTE4[3-0]（低 4

int 型转换过来，转换过程为：

BYTE5

位）为其⾼ 4 位，BYTE5 为其低 8 位。

t_double = t_int * 100 / 4095 - 50

单位是 N.m。

转矩常数的单位为 N.m/A

➢  Get_Encoder_Estimates

CMD ID: 0x009（电机→主机）

起始字节  名称

类型

单位

说明

0

4

Pos_Estimate

float32

rev

odrv0.axis0.encoder.pos_estimate

当前电机转子的位置

Vel_Estimate

float32

rev/s

odrv0.axis0.encoder.vel_estimate

当前电机转子的转速

➢  Get_Encoder_Count

CMD ID: 0x00A（电机→主机）

起始字节  名称

类型

说明

0

4

Shadow_Count

int32

odrv0.axis0.encoder.shadow_count

编码器多圈计数

Count_In_Cpr

int32

odrv0.axis0.encoder.count_in_cpr

编码器单圈计数

➢

Set_Controller_Mode

CMD ID: 0x00B（主机→电机）

起始字节  名称

0

Control_Mode

类型

uint32

说明

odrv0.axis0.controller.config.control_mode 控

制模式：

0：电压控制

1：力矩控制

2：速度控制

3：位置控制

4

Input_Mode

uint32

odrv0.axis0.controller.config.input_mode

48

  江西伺泰威自动化设备有限公司

rev2.2

输入模式，表示用户输入的控制值以什么方

式去控制电机运转：

0：闲置

1：直接控制

2：速度斜坡

3：位置滤波

5：梯形曲线

6：力矩斜坡

9：运动控制（MIT）

➢

Set_Input_Pos

CMD ID: 0x00C（主机→电机）

起始字节  名称

类型

单位

说明

0

4

6

Input_Pos

float32

rev

odrv0.axis0.controller.input_pos

位置控制的目标值。

Vel_FF

int16

0.001rev/s

odrv0.axis0.controller.input_vel

位置控制的速度前馈。

Torque_FF

int16

0.001Nm

odrv0.axis0.controller.input_torque

位置控制的力矩前馈。

➢

Set_Input_Vel

CMD ID: 0x00D（主机→电机）

起始字节  名称

类型

Input_Vel

float32

0

4

单位

rev/s

说明

odrv0.axis0.controller.input_vel

速度控制的目标值。

Torque_FF

float32

Nm

odrv0.axis0.controller.input_torque

速度控制的力矩前馈。

➢

Set_Input_Torque

CMD ID: 0x00E（主机→电机）

起始字节  名称

类型

单位

说明

0

Input_Torque

float32

Nm

odrv0.axis0.controller.input_torque

力矩控制的目标值。

➢

Set_Limits

CMD ID: 0x00F（主机→电机）

起始字节  名称

类型

单位  说明

0

Velocity_Limit

float32

rev/s

odrv0.axis0.controller.config.vel_limit

全局速度限制。

49

4

  江西伺泰威自动化设备有限公司
float32

Current_Limit

A

odrv0.axis0.motor.config.current_lim

rev2.2

电机电流限制。

➢

Start_Anticogging

CMD ID: 0x010（主机→电机）

进行力矩纹波校准。

➢

Set_Traj_Vel_Limit

CMD ID: 0x011（主机→电机）

起始字节  名称

类型

单位  说明

0

Traj_Vel_Limit

float32

rev/s

odrv0.axis0.trap_traj.config.vel_limit

梯形位置控制的速度限制。

➢

Set_Traj_Accel_Limits

CMD ID: 0x012（主机→电机）

起始字节  名称

类型

单位

说明

0

4

Traj_Accel_Limit

float32

rev/s^2

odrv0.axis0.trap_traj.config.accel_lim

it

梯形位置控制的加速度限制。

Traj_Decel_Limit

float32

rev/s^2

odrv0.axis0.trap_traj.config.decel_li

mit

梯形位置控制的减速度限制。

➢

Set_Traj_Inertia

CMD ID: 0x013（主机→电机）

起始字节  名称

类型

单位

说明

0

Traj_Inertia

float32

Nm/(rev/s^2)

odrv0.axis0.controller.config.inertia

惯量。

➢  Get_Iq

CMD ID: 0x014（电机→主机）

起始字节  名称

类型

单位  说明

0

4

Iq_Setpoint

float32

A

odrv0.axis0.motor.current_control.Idq_setp

oint

Q 轴电流目标值。

Iq_Measured

float32

A

odrv0.axis0.motor.current_control.Iq_meas

ured

Q 轴电流实际测量值。

50

  江西伺泰威自动化设备有限公司

rev2.2

➢  Reboot

CMD ID: 0x016（主机→电机）

➢  Get_Bus_Voltage_Current

CMD ID: 0x017（电机→主机）

起始字节  名称

类型

单位  说明

0

4

Bus_Voltage

float32

V

odrv0.vbus_voltage

Bus_Current

float32

A

odrv0.ibus

母线电流。

母线电压。

➢  Clear_Errors

CMD ID: 0x018（主机→电机）

清除所有错误和异常。

➢

Set_Linear_Count

CMD ID: 0x019（主机→电机）

设置编码器绝对位置。

起始字节  名称

0

Linear_Count

类型

int32

说明

odrv0.axis0.encoder.set_linear_count()

设置编码器绝对位置（计数值）。

➢

Set_Pos_Gain

CMD ID: 0x01A（主机→电机）

起始字节  名称

类型

单位

说明

0

Pos_Gain

float32

(rev/s)/rev

odrv0.axis0.controller.config.pos_gain

位置环增益 Kp。

➢

Set_Vel_Gains

CMD ID: 0x01B（主机→电机）

起始字节  名称

类型

单位

说明

0

4

Vel_Gain

float32

Nm/(rev/s)

odrv0.axis0.controller.config.vel_gain

速度环增益 Kp。

Vel_Integrato

float32

Nm/rev

odrv0.

r_Gain

axis0.controller.config.vel_integrator_

gain

速度环增益 Ki。

➢  Get_Torques

51

  江西伺泰威自动化设备有限公司

rev2.2

CMD ID: 0x01C（电机→主机）

起始字节  名称

类型

单位  说明

0

4

Torque_Setpoint

float32

Nm

odrv0.axis0.controller.torque_setpoint

Torque

float32

Nm

表示当前力矩值。

电流环力矩目标值。

➢  Get_Powers

CMD ID: 0x01D（电机→主机）

起始字节  名称

类型

说明

0

4

Electrical_Power

float32

odrv0.axis0.controller.electrical_power

电功率

Mechanical_Power

float32

odrv0.axis0.controller.mechanical_power

机械功率

➢  Disable_Can

CMD ID: 0x01E（主机→电机）

禁用 CAN，并重启驱动器。

➢

Save_Configuration

CMD ID: 0x01F（主机→电机）

存储当前的配置，生效并重启。

4.1.3 CAN 协议实战

4.1.3.1  实战：上电校准

发送 CAN 消息的序列如下：

CAN ID

0x007

帧类型

数据帧

帧数据

说明

04 00 00 00 00 00 00 00

消息：Set_Axis_State

参数：4

对电机进行校准

0x007

数据帧

07 00 00 00 00 00 00 00

消息：Set_Axis_State

参数：7

对编码器进行校准

4.1.3.2  实战：速度控制

发送 CAN 消息的序列如下：

CAN ID

0x00B

帧类型

数据帧

帧数据

说明

02 00 00 00 02 00 00 00

消息：Set_Controller_Mode

52

  江西伺泰威自动化设备有限公司

rev2.2

参数：2/2

设置控制模式为速度控制，输入模

式为速度斜坡

0x007

数据帧

08 00 00 00 00 00 00 00

消息：Set_Axis_State

参数：8

进入闭环控制状态

0x0D

数据帧

00 00 20 41 00 00 00 00

消息：Set_Input_Vel

参数：10/0

设置目标速度和力矩前馈，其中目

标速度为 10（浮点数：

0x41200000），力矩前馈为 0（浮

点数：0x00000000）

4.1.3.3  实战：位置控制

发送 CAN 消息的序列如下：

CAN ID

0x00B

帧类型

数据帧

帧数据

说明

03 00 00 00 03 00 00 00

消息：Set_Controller_Mode

参数：3/3

设置控制模式为位置控制，输入模

式为位置滤波

0x007

数据帧

08 00 00 00 00 00 00 00

消息：Set_Axis_State

参数：8

进入闭环控制状态

0x0C

数据帧

CD CC 0C 40 00 00 00 00  消息：Set_Input_Pos

参数：2.2/0/0

设置目标位置，速度前馈和力矩前

馈，其中目标位置为 2.2（浮点数：

0x400CCCCD），力矩前馈和速度

前馈为 0

4.1.4 CANOpen 兼容性

如果 node ID 分配得当，可与 CANOpen 互通。下表列出了 CANopen 和本协议的有效

node ID 组合：

CANOpen node IDs  本协议 node IDs

32 … 127

64 … 127

96 … 127

0x10, 0x18, 0x20, 0x28

0x10, 0x11, 0x18, 0x19, 0x20, 0x21, 0x28, 0x29

0x10, 0x11, 0x12, 0x18, 0x19, 0x1A, 0x20, 0x21, 0x22, 0x28, 0x29,

0x2A

53

  江西伺泰威自动化设备有限公司

rev2.2

4.1.5 周期消息

用户可配置电机向上位机周期性发送消息，而不用上位机向电机发送请求消息。可通过

odrv0.axis0.config.can 下的一系列配置来打开/关闭周期消息（值为 0 表示关闭，为其他值表示

周期时间，单位为 ms），如下表所示：

消息

Heartbeat

odrivetool 配置

odrv0.axis0.config.can.heartbeat_rate_ms

Get_Encoder_Estimates

odrv0.axis0.config.can.encoder_rate_ms

默认值

100

10

Get_Motor_Error

odrv0.axis0.config.can.motor_error_rate_ms

Get_Encoder_Error

odrv0.axis0.config.can.encoder_error_rate_ms

Get_Controller_Error

odrv0.axis0.config.can.controller_error_rate_ms

Get_Sensorless_Error

odrv0.axis0.config.can.sensorless_error_rate_ms

Get_Encoder_Count

odrv0.axis0.config.can.encoder_count_rate_ms

Get_Iq

odrv0.axis0.config.can.iq_rate_ms

Get_Sensorless_Estimates  odrv0.axis0.config.can.sensorless_rate_ms

Get_Bus_Voltage_Current  odrv0.axis0.config.can.bus_vi_rate_ms

0

0

0

0

0

0

0

0

默认情况下，前两种周期消息在出⼚时打开，所以当用户监控 CAN 总线时，会看到两种消

息以设定周期进行广播。用户可通过下述指令关闭它们：

odrv0.axis0.config.can.heartbeat_rate_ms = 0

odrv0.axis0.config.can.encoder_rate_ms = 0

对于各个消息的详细内容，请参见 4.1.2。

4.2  CANOpen 协议

CANOpen 是用于自动化领域的通信协议规范，本产品遵循 CiA301，CiA302，CiA402 规范

实现。在使用本产品的 CANOpen 协议前，通过下述 odrivetool 指令将 can 协议切换到

CANOpen：

odrv0.can.config.protocol = 2

4.2.1 设备描述文件（EDS）

EDS 文件描述了设备的功能和通信参数。要通过 CANOpen 跟本产品通信，必须导入本产

品的 EDS 文件。请通过下述链接下载：https://bl.cyberbeast.cn/actuator/cb_0.1.eds

4.2.2 协议帧格式

CANOpen 基于标准 CAN，其 11 位的 ID 分为 4 位功能码和 7 位节点 ID（node_id），这表

示总线上最多支持 127 个节点（0 被用于广播）。下表是帧格式示意：

数据域

分段

COB-ID / CAN ID（11bits）

Bit10 ~ Bit7

Bit6 ~ Bit0

Data（8 bytes）

Byte0 ~ Byte7

54

  江西伺泰威自动化设备有限公司

rev2.2

描述

功能码

node_id

通信数据

功能码表如下：

通信功能

COB-ID

NMT

SYNC

EMCY

0x000

0x080

0x080+node_id

TPDO1~TPDO4

0x180/0x280/0x380/0x480+node_id

RPDO1~RPDO4

0x200/0x300/0x400/0x500+node_id

TSDO

RSDO

0x600+node_id

0x580+node_id

NMT（⼼跳）

0x700+node_id

4.2.3 帧消息

说明

网络管理

同步

应急管理

实时过程数据发送

实时过程数据接收

服务数据发送

服务数据接收

⼼跳

根据 CAN ID（COB-ID）的不同，帧消息的格式也有所不同。

4.2.3.1  NMT（网络管理）

NMT 用于向总线上所有节点，或特定节点发布状态改变命令，它的 COB-ID 始终为 0，数

据包含 2 个字节，如下表：

COB-ID

0x000

Data Byte0

状态命令字

Data Byte1

node_id

其中状态命令字包含：

状态命令字

0x01

0x02

0x80

0x81

0x82

说明

状态改变为“operational”

状态改变为“stopped”

状态改变为“pre-operational”

复位节点“reset node”

复位通信“reset communication”

例如，用户在连接上驱动器后，首先发送下述 NMT 指令让总线上所有节点运行起来：

COB-ID

0x000

Data

01 00

4.2.3.2  SYNC

同步功能用于让总线上所有节点同步，主要用于让节点同步 PDO 消息。其 COB-ID 固定为

0x80，数据域为空。

例如，用户在用 NMT 指令让总线上节点运行起来过后，一般会发送 SYNC 消息让节点开始

传输 PDO 数据。

4.2.3.3  PDO

PDO 是为实时数据传输准备的通信方式，当用户希望周期性获取节点数据，或者让用户在

事件驱动下上报数据，均使用 PDO 进行传输。PDO 只在节点状态处于“operational”时使用，所

以用户必须要首先用 NMT 消息改变节点状态。

55

  江西伺泰威自动化设备有限公司

rev2.2

PDO 消息数据域的格式是根据其映射结构决定的，这种映射结构并不是标准的，而是由

EDS 文件规定。

4.2.3.4  SDO

SDO 通信允许访问本产品的对象字典数据（对象字典由 EDS 规定）。所谓的对象字典数

据，可以理解为产品的参数信息。一般来说，SDO 仅用于配置过程，而不用于运行过程中的数

据交换。实时的运行数据交换，建议用 PDO。

SDO 分为读和写两种不同的过程，下表是写过程（也叫 upload）：

COB-ID  Data

Data

Data

Data

Data

Data

Data

Data

Byte0

Byte1

Byte2

Byte3

Byte4

Byte5

Byte6

Byte7

write

0x600+

0x23

index

node_id

0x27

index

0x2B

index

0x2F

index

subindex

subindex

subindex

subindex

data

data

data

data

response

0x580+

0x60

index

subindex

/

/

/

/

/

/

/

/

/

/

node_id

0x80

Index

subindex

abortion code

读过程（也叫 download）：

COB-ID  Data

Data

Data

Data

Data

Data

Data

Data

Byte0

Byte1

Byte2

Byte3

Byte4

Byte5

Byte6

Byte7

read

0x600+

0x40

index

subindex

/

/

/

node_id

response

0x580+

0x43

index

node_id

0x47

index

0x4B

index

0x4F

index

0x80

index

subindex

subindex

subindex

subindex

data

data

data

data

/

/

/

subindex

abortion code

/

/

/

/

4.2.3.5  NMT（心跳）

⼼跳消息仅仅用来向总线展示节点的状态，表示节点正常工作。帧格式如下：

COB-ID

0x700+node_id

Data Byte0

状态

4.3 RS485 协议（Modbus RTU）

请注意，在版本大于等于 3.10 的硬件版本上，通信接口同时支持 RS485，脉冲方向和

PWM。通过下述指令确保通信接口是 RS485：

odrv0.config.comm_intf_mux = 1

56

  江西伺泰威自动化设备有限公司

rev2.2

在电机精灵中，也可在通信参数中，切换物理接口。

基于 RS485 的 Modbus RTU，最大通信速率 115200bps，出⼚默认速率 115200bps。

4.3.1 Modbus RTU

基于工业标准的 Modbus RTU，目前支持的功能码如下：

功能码

0x04

0x03

0x06

0x10

含义

读单个或多个输入寄存器

读多个保持寄存器

写单个保持寄存器

写多个保持寄存器

4.3.2 输入寄存器

输入寄存器仅支持读，不能写，表示系统的一些状态或动态指标，如错误信息，电压/电流

等，目前支持的输入寄存器如下：

➢

0x01：电机状态

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 01

2 字节

00 01

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

02

State0 State1

XX XX

其中 State0 始终为 0，State1 为电机状态码：

电机状态码

1

3

4

说明

空闲

完全校准

电机校准

57

  江西伺泰威自动化设备有限公司

rev2.2

7

8

11

➢

0x02：异常标志

主机请求：

编码器校准

闭环运行

回零

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 02

2 字节

00 01

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

02

Flag0 Flag1

XX XX

其中 Flag0 始终为 0，Flag1 为异常标志，每个 bit 为 1 代表出现相对应的异常，异常代表

如下：

bit7~bit5

bit4

bit3

bit2

bit1

bit0

⽆含义

驱动异常

系统异常

控制异常

编码器异常  电机异常

➢

➢

0x03：驱动异常码 1

0x04：驱动异常码 2

驱动异常码为 32 位⽆符号整数，其中驱动异常码 1 为其⾼ 16 位，驱动异常码 2 为其低 16

位。用户只能通过访问寄存器地址 0x03，同时获取两个寄存器数据，从而获取完整的驱动异常

码。不可单独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 03

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

58

  江西伺泰威自动化设备有限公司

rev2.2

XX

04

04

E0 E1 E2 E3

XX XX

E0 E1 E2 E3 组成驱动异常码，请参见 5.2 节的异常码表格。

➢

➢

➢

➢

0x05：电机异常码 1

0x06：电机异常码 2

0x07：电机异常码 3

0x08：电机异常码 4

电机异常码为 64 位⽆符号整数，其中电机异常码 1 为其 63 到 48 位，电机异常码 2 为其

47 到 32 位，电机异常码 3 为其 31 到 16 位，电机异常码 4 为其 15 位到 0 位。用户只能通过

访问寄存器地址 0x05，同时获取四个寄存器数据，从而获取完整的电机异常码。不可单独访问

任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 05

2 字节

00 04

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

8 字节

2 字节

XX

04

08

E0 E1 E2 E3 E4

XX XX

E5 E6 E7

E0 E1 E2 E3 E4 E5 E6 E7 组成电机异常码，请参见 5.2 节的异常码表格。

➢

➢

0x09：编码器异常码 1

0x0A：编码器异常码 2

编码器异常码为 32 位⽆符号整数，其中编码器异常码 1 为其⾼ 16 位，编码器异常码 2 为

其低 16 位。用户只能通过访问寄存器地址 0x09，同时获取两个寄存器数据，从而获取完整的

编码器异常码。不可单独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 09

2 字节

00 02

2 字节

XX XX

59

  江西伺泰威自动化设备有限公司

rev2.2

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

E0 E1 E2 E3

XX XX

E0 E1 E2 E3 组成编码器异常码，请参见 5.2 节的异常码表格。

➢

➢

0x0B：控制异常码 1

0x0C：控制异常码 2

控制异常码为 32 位⽆符号整数，其中控制异常码 1 为其⾼ 16 位，控制异常码 2 为其低 16

位。用户只能通过访问寄存器地址 0x0B，同时获取两个寄存器数据，从而获取完整的控制异常

码。不可单独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 0B

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

E0 E1 E2 E3

XX XX

E0 E1 E2 E3 组成控制异常码，请参见 5.2 节的异常码表格。

➢

➢

0x0D：系统异常码 1

0x0E：系统异常码 2

系统异常码为 32 位⽆符号整数，其中系统异常码 1 为其⾼ 16 位，系统异常码 2 为其低 16

位。用户只能通过访问寄存器地址 0x0D，同时获取两个寄存器数据，从而获取完整的系统异常

码。不可单独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 0D

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

60

  江西伺泰威自动化设备有限公司

rev2.2

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

E0 E1 E2 E3

XX XX

E0 E1 E2 E3 组成系统异常码，请参见 5.2 节的异常码表格。

➢

0x0F：位置反馈 1

➢

0x10：位置反馈 2

位置反馈为 32 位浮点数，其中位置反馈 1 为其⾼ 16 位，位置反馈 2 为其低 16 位。用户

只能通过访问寄存器地址 0x0F，同时获取两个寄存器数据，从而获取完整的位置反馈。不可单

独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 0F

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

P0 P1 P2 P3

XX XX

P0 P1 P2 P3 组成位置反馈，其中 32 位浮点数按照 IEEE 754 标准进行编码（可通过网站

https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

0x11：速度反馈 1

➢

0x12：速度反馈 2

速度反馈为 32 位浮点数，其中速度反馈 1 为其⾼ 16 位，速度反馈 2 为其低 16 位。用户

只能通过访问寄存器地址 0x11，同时获取两个寄存器数据，从而获取完整的速度反馈。不可单

独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

2 字节

00 11

2 字节

00 02

2 字节

XX XX

电机响应：

地址

功能码

字节⻓度

寄存器值

校验码

61

  江西伺泰威自动化设备有限公司

rev2.2

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

V0 V1 V2 V3

XX XX

V0 V1 V2 V3 组成速度反馈，其中 32 位浮点数按照 IEEE 754 标准进行编码（可通过网站

https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

➢

0x13：母线电压反馈 1

0x14：母线电压反馈 2

母线电压为 32 位浮点数，其中母线电压 1 为其⾼ 16 位，母线电压 2 为其低 16 位。用户

只能通过访问寄存器地址 0x13，同时获取两个寄存器数据，从而获取完整的母线电压。不可单

独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 13

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

V0 V1 V2 V3

XX XX

V0 V1 V2 V3 组成母线电压，其中 32 位浮点数按照 IEEE 754 标准进行编码（可通过网站

https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

➢

0x15：母线电流反馈 1

0x16：母线电流反馈 2

母线电流反馈为 32 位浮点数，其中母线电流反馈 1 为其⾼ 16 位，母线电流反馈 2 为其低

16 位。用户只能通过访问寄存器地址 0x15，同时获取两个寄存器数据，从而获取完整的母线

电流反馈。不可单独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

2 字节

00 15

2 字节

00 02

2 字节

XX XX

电机响应：

62

  江西伺泰威自动化设备有限公司

rev2.2

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

I0 I1 I2 I3

XX XX

I0 I1 I2 I3 组成母线电流反馈，其中 32 位浮点数按照 IEEE 754 标准进行编码（可通过网站

https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

➢

0x17：Q 轴电流目标值 1

0x18：Q 轴电流目标值 2

Q 轴电流目标值为 32 位浮点数，其中 Q 轴电流目标值 1 为其⾼ 16 位，Q 轴电流目标值 2

为其低 16 位。用户只能通过访问寄存器地址 0x17，同时获取两个寄存器数据，从而获取完整

的 Q 轴电流目标值。不可单独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 17

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

I0 I1 I2 I3

XX XX

I0 I1 I2 I3 组成 Q 轴电流目标值，其中 32 位浮点数按照 IEEE 754 标准进行编码（可通过网

站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

➢

0x19：Q 轴电流反馈 1

0x1A：Q 轴电流反馈 2

Q 轴电流反馈为 32 位浮点数，其中 Q 轴电流反馈 1 为其⾼ 16 位，Q 轴电流反馈 2 为其低

16 位。用户只能通过访问寄存器地址 0x19，同时获取两个寄存器数据，从而获取完整的 Q 轴

电流反馈。不可单独访问任何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 19

2 字节

00 02

2 字节

XX XX

63

  江西伺泰威自动化设备有限公司

rev2.2

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

I0 I1 I2 I3

XX XX

I0 I1 I2 I3 组成 Q 轴电流反馈，其中 32 位浮点数按照 IEEE 754 标准进行编码（可通过网站

https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

➢

0x31：随机端点访问返回值 1

0x32：随机端点访问返回值 2

随机端点访问是指用户可读取/写入任何支持的参数，所谓的“端点”即是代指参数，每个参

数均有唯一的端点号。当用户想读取某个参数时，可通过端点描述文件获得该参数的端点号，

将其写入到保持寄存器 0xA1 中，然后再读取输入寄存器 0x31 获得该参数值。请参考保持寄存

器 0xA1 的描述获取下载端点描述文件的地址。

随机端点访问返回值为 32 位数，有可能是 16 位整数，32 位整数或 32 位浮点数，其中随

机端点访问返回值 1 为其⾼ 16 位，随机端点访问返回值 2 为其低 16 位。用户只能通过访问寄

存器地址 0x31，同时读两个寄存器数据，从而获取完整的返回值（参数值）。不可单独访问任

何一个寄存器。

主机请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

04

电机响应：

2 字节

00 31

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

04

04

V0 V1 V2 V3

XX XX

其中 V0 V1 V2 V3 为随机端点访问返回值的从⾼到低的 4 个字节，其中 32 位浮点数按照

IEEE 754 标准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测

试编码）。

4.3.3 保持寄存器

保持寄存器可读可写，目前支持的寄存器及其功能如下：

➢

0x61：紧急停止

向此寄存器写入任何数值，均会让电机紧急停止。

64

  江西伺泰威自动化设备有限公司

rev2.2

主机请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

电机响应：

2 字节

00 61

2 字节

XX XX

2 字节

XX XX

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 61

2 字节

XX XX

2 字节

XX XX

➢

0x62：节点 ID

用 06 功能码向此节点写入节点 ID，或者用 03 功能码读取当前节点 ID。

写入节点 ID 请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

电机响应：

2 字节

00 62

2 字节

2 字节

ID0 ID1

XX XX

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 62

2 字节

2 字节

ID0 ID1

XX XX

其中 ID0 和 ID1 为新节点 ID 的⾼ 8 位和低 8 位。

读取当前节点 ID 请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 62

2 字节

00 01

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

02

ID0 ID1

XX XX

65

  江西伺泰威自动化设备有限公司

rev2.2

➢

0x63：状态控制

用 06 功能码向此节点写入电机状态（改变电机状态）。

主机请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

电机响应：

2 字节

00 63

2 字节

S0 S1

2 字节

XX XX

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 63

2 字节

S0 S1

2 字节

XX XX

其中 S0 和 S1 为电机状态的⾼ 8 位和低 8 位。状态定义如下：

电机状态码

1

3

4

7

8

11

说明

空闲

完全校准

电机校准

编码器校准

闭环运行

回零

⽐如，将电机状态设置为 8（闭环运行），即为通常意义上的“开启电机”；将电机状态设置

为 1（空闲），即为通常意义上的“关闭电机”。

➢

0x64：控制模式

用户可用 06 功能码修改此寄存器的值进入力矩控制，或速度控制，或位置控制模式，或

者用 03 功能码读取当前的控制模式。

修改控制模式请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

电机响应：

2 字节

00 64

2 字节

M0 M1

2 字节

XX XX

66

  江西伺泰威自动化设备有限公司

rev2.2

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

读取控制模式请求：

2 字节

00 64

2 字节

2 字节

M0 M1

XX XX

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 64

2 字节

00 01

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

XX

03

02

M0 M1

2 字节

XX XX

其中 M0 和 M1 为控制模式的⾼ 8 位和低 8 位。控制模式定义如下：

控制模式

1

2

3

说明

力矩控制

速度控制

位置控制

➢

0x65：输入模式

用户可用 06 功能码修改此寄存器的值从而选择不同的目标值输入模式，如直接输入，滤

波输入等，或者用 03 功能码读取当前的输入模式。

修改输入模式请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 65

2 字节

M0 M1

2 字节

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 65

2 字节

M0 M1

2 字节

XX XX

67

  江西伺泰威自动化设备有限公司

rev2.2

读取输入模式请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 65

2 字节

00 01

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

XX

03

02

M0 M1

2 字节

XX XX

其中 M0 和 M1 为输入模式的⾼ 8 位和低 8 位。输入模式定义如下：

控制模式

说明

详细解释

1

2

3

5

6

直接输入

用户输入的目标值直接作为驱动器的目标值

速度斜坡

驱动器的速度目标值会在一定时间内按照一定斜率达到

用户输入的速度目标值，仅用于速度控制

位置滤波

驱动器的位置目标值是用户输入的位置目标值经过滤波

处理过后的数值，仅用于位置控制

梯形曲线

驱动器会驱动电机按照梯形的速度曲线到达用户输入的

目标值，其中梯形的上升斜率（加速度），下降斜率

（减速度），滑行速度均可设置，请参考后续寄存器

0x70~0x75

力矩斜坡

驱动器的力矩目标值会在一定时间内按照一定斜率达到

用户输入的目标力矩值，仅用于力矩控制

➢

➢

0x66：位置控制目标 1

0x67：位置控制目标 2

位置控制目标为 32 位浮点数，其中位置控制目标 1 为其⾼ 16 位，位置控制目标 2 为其低

16 位。用户只能通过访问寄存器地址 0x66，同时读/写两个寄存器数据，从而获取/修改完整的

位置控制目标。不可单独访问任何一个寄存器。

修改/更新位置控制目标请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

68

  江西伺泰威自动化设备有限公司

rev2.2

XX

10

00 66

00 02

04

P0 P1 P2 P3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

2 字节

00 66

2 字节

00 02

2 字节

XX XX

读取位置控制目标请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 66

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

P0 P1 P2 P3

XX XX

其中 P0 P1 P2 P3 为位置控制目标的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE 754

标准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编

码）。

➢

➢

0x68：速度控制目标 1

0x69：速度控制目标 2

速度控制目标为 32 位浮点数，其中速度控制目标 1 为其⾼ 16 位，速度控制目标 2 为其低

16 位。用户只能通过访问寄存器地址 0x68，同时读/写两个寄存器数据，从而获取/修改完整的

速度控制目标。不可单独访问任何一个寄存器。

修改/更新速度控制目标请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 68

00 02

04

V0 V1 V2 V3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

2 字节

2 字节

2 字节

69

  江西伺泰威自动化设备有限公司

rev2.2

XX

10

00 68

00 02

XX XX

读取速度控制目标请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 68

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

V0 V1 V2 V3

XX XX

其中 V0 V1 V2 V3 为速度控制目标的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE 754

标准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编

码）。

➢

➢

0x6A：力矩控制目标 1

0x6B：力矩控制目标 2

力矩控制目标为 32 位浮点数，其中力矩控制目标 1 为其⾼ 16 位，力矩控制目标 2 为其低

16 位。用户只能通过访问寄存器地址 0x6A，同时读/写两个寄存器数据，从而获取/修改完整的

力矩控制目标。不可单独访问任何一个寄存器。

修改/更新力矩控制目标请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 6A

00 02

04

T0 T1 T2 T3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

2 字节

00 6A

2 字节

00 02

2 字节

XX XX

读取力矩控制目标请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

2 字节

2 字节

2 字节

70

  江西伺泰威自动化设备有限公司

rev2.2

XX

03

00 6A

00 02

XX XX

电机响应：

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

T0 T1 T2 T3

XX XX

其中 T0 T1 T2 T3 为力矩控制目标的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE 754

标准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编

码）。

➢

0x6C：速度限制 1

➢

0x6D：速度限制 2

速度限制为 32 位浮点数，其中速度限制 1 为其⾼ 16 位，速度限制 2 为其低 16 位。用户

只能通过访问寄存器地址 0x6C，同时读/写两个寄存器数据，从而获取/修改完整的速度限制。

不可单独访问任何一个寄存器。

修改/更新速度限制请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 6C

00 02

04

V0 V1 V2 V3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

读取速度限制请求：

2 字节

00 6C

2 字节

00 02

2 字节

XX XX

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 6C

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

71

  江西伺泰威自动化设备有限公司

rev2.2

XX

03

04

V0 V1 V2 V3

XX XX

其中 V0 V1 V2 V3 为速度限制的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE 754 标

准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编

码）。

➢

0x6E：电流限制 1

➢

0x6F：电流限制 2

电流限制为 32 位浮点数，其中电流限制 1 为其⾼ 16 位，电流限制 2 为其低 16 位。用户

只能通过访问寄存器地址 0x6E，同时读/写两个寄存器数据，从而获取/修改完整的电流限制。

不可单独访问任何一个寄存器。

修改/更新电流限制请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 6E

00 02

04

I0 I1 I2 I3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

读取电流限制请求：

2 字节

00 6E

2 字节

00 02

2 字节

XX XX

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 6E

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

I0 I1 I2 I3

XX XX

其中 I0 I1 I2 I3 为电流限制的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE 754 标准进

行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

➢

0x70：梯形位置控制速度限制 1

0x71：梯形位置控制速度限制 2

72

  江西伺泰威自动化设备有限公司

rev2.2

梯形位置控制速度限制为 32 位浮点数，其中梯形位置控制速度限制 1 为其⾼ 16 位，梯形

位置控制速度限制 2 为其低 16 位。用户只能通过访问寄存器地址 0x70，同时读/写两个寄存器

数据，从而获取/修改完整的梯形位置控制速度限制。不可单独访问任何一个寄存器。

修改/更新梯形位置控制速度限制请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 70

00 02

04

V0 V1 V2 V3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

2 字节

00 70

2 字节

00 02

2 字节

XX XX

读取梯形位置控制速度限制请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 70

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

V0 V1 V2 V3

XX XX

其中 V0 V1 V2 V3 为梯形位置控制速度限制的从⾼到低的 4 个字节，其中 32 位浮点数按照

IEEE 754 标准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测

试编码）。

➢

➢

0x72：梯形位置控制加速度限制 1

0x73：梯形位置控制加速度限制 2

梯形位置控制加速度限制为 32 位浮点数，其中梯形位置控制加速度限制 1 为其⾼ 16 位，

梯形位置控制加速度限制 2 为其低 16 位。用户只能通过访问寄存器地址 0x72，同时读/写两个

寄存器数据，从而获取/修改完整的梯形位置控制加速度限制。不可单独访问任何一个寄存器。

修改/更新梯形位置控制加速度限制请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

73

  江西伺泰威自动化设备有限公司

rev2.2

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 72

00 02

04

A0 A1 A2 A3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

2 字节

00 72

2 字节

00 02

2 字节

XX XX

读取梯形位置控制加速度限制请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 72

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

A0 A1 A2 A3

XX XX

其中 A0 A1 A2 A3 为梯形位置控制加速度限制的从⾼到低的 4 个字节，其中 32 位浮点数

按照 IEEE 754 标准进行编码（可通过网站 https://www.h-

schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

➢

0x74：梯形位置控制减速度限制 1

0x75：梯形位置控制减速度限制 2

梯形位置控制减速度限制为 32 位浮点数，其中梯形位置控制减速度限制 1 为其⾼ 16 位，

梯形位置控制减速度限制 2 为其低 16 位。用户只能通过访问寄存器地址 0x74，同时读/写两个

寄存器数据，从而获取/修改完整的梯形位置控制减速度限制。不可单独访问任何一个寄存器。

修改/更新梯形位置控制减速度限制请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 74

00 02

04

D0 D1 D2 D3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

74

  江西伺泰威自动化设备有限公司

rev2.2

1 字节

1 字节

XX

10

2 字节

00 74

2 字节

00 02

2 字节

XX XX

读取梯形位置控制减速度限制请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 74

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

D0 D1 D2 D3

XX XX

其中 D0 D1 D2 D3 为梯形位置控制减速度限制的从⾼到低的 4 个字节，其中 32 位浮点数

按照 IEEE 754 标准进行编码（可通过网站 https://www.h-

schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

0x76：惯量 1

➢

0x77：惯量 2

惯量为 32 位浮点数，其中惯量 1 为其⾼ 16 位，惯量 2 为其低 16 位。用户只能通过访问

寄存器地址 0x76，同时读/写两个寄存器数据，从而获取/修改完整的惯量。不可单独访问任何

一个寄存器。

修改/更新惯量请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 76

00 02

04

I0 I1 I2 I3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

读取惯量请求：

2 字节

00 76

2 字节

00 02

2 字节

XX XX

地址

功能码

寄存器地址

寄存器个数

校验码

75

  江西伺泰威自动化设备有限公司

rev2.2

1 字节

1 字节

XX

03

2 字节

00 76

2 字节

00 02

2 字节

XX XX

电机响应：

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

I0 I1 I2 I3

XX XX

其中 I0 I1 I2 I3 为惯量的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE 754 标准进行编

码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编码）。

➢

0x78：位置增益 1

➢

0x79：位置增益 2

位置增益为 32 位浮点数，其中位置增益 1 为其⾼ 16 位，位置增益 2 为其低 16 位。用户

只能通过访问寄存器地址 0x78，同时读/写两个寄存器数据，从而获取/修改完整的位置增益。

不可单独访问任何一个寄存器。

修改/更新位置增益请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 78

00 02

04

G0 G1 G2 G3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

读取位置增益请求：

2 字节

00 78

2 字节

00 02

2 字节

XX XX

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 78

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

76

  江西伺泰威自动化设备有限公司

rev2.2

XX

03

04

G0 G1 G2 G3

XX XX

其中 G0 G1 G2 G3 为位置增益的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE 754 标

准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编

码）。

➢

0x7A：速度增益 1

➢

0x7B：速度增益 2

速度增益为 32 位浮点数，其中速度增益 1 为其⾼ 16 位，速度增益 2 为其低 16 位。用户

只能通过访问寄存器地址 0x7A，同时读/写两个寄存器数据，从而获取/修改完整的速度增益。

不可单独访问任何一个寄存器。

修改/更新速度增益请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 7A

00 02

04

G0 G1 G2 G3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

读取速度增益请求：

2 字节

00 7A

2 字节

00 02

2 字节

XX XX

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 7A

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

G0 G1 G2 G3

XX XX

其中 G0 G1 G2 G3 为速度增益的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE 754 标

准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编

码）。

➢

➢

0x7C：速度积分增益 1

0x7D：速度积分增益 2

77

  江西伺泰威自动化设备有限公司

rev2.2

速度积分增益为 32 位浮点数，其中速度积分增益 1 为其⾼ 16 位，速度积分增益 2 为其低

16 位。用户只能通过访问寄存器地址 0x7C，同时读/写两个寄存器数据，从而获取/修改完整的

速度积分增益。不可单独访问任何一个寄存器。

修改/更新速度积分增益请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 7C

00 02

04

G0 G1 G2 G3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

2 字节

00 7C

2 字节

00 02

2 字节

XX XX

读取速度积分增益请求：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

03

电机响应：

2 字节

00 7C

2 字节

00 02

2 字节

XX XX

地址

功能码

字节⻓度

寄存器值

校验码

1 字节

1 字节

1 字节

2 字节

2 字节

XX

03

04

G0 G1 G2 G3

XX XX

其中 G0 G1 G2 G3 为速度积分增益的从⾼到低的 4 个字节，其中 32 位浮点数按照 IEEE

754 标准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编

码）。

➢

0x7E：重启

向此寄存器写入任何数值，均会让电机驱动器重启。

主机请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

电机响应：

2 字节

00 7E

2 字节

XX XX

2 字节

XX XX

78

  江西伺泰威自动化设备有限公司

rev2.2

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 7E

2 字节

XX XX

2 字节

XX XX

➢

0x7F：清除异常

向此寄存器写入任何数值，均会清除所有错误和异常。

主机请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

电机响应：

2 字节

00 7F

2 字节

XX XX

2 字节

XX XX

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 7F

2 字节

XX XX

2 字节

XX XX

➢

0x80：存储配置

向此寄存器写入任何数值，均会保存当前所有参数到驱动器 Flash 中永久存储。

主机请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

电机响应：

2 字节

00 80

2 字节

XX XX

2 字节

XX XX

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 80

2 字节

XX XX

2 字节

XX XX

➢

0xA1：随机端点访问端点号

随机端点访问是指用户可读取/写入任何支持的参数，所谓的“端点”即是代指参数，每个参

数均有唯一的端点号。当用户想读取/写入某个参数时，可通过端点描述文件获得该参数的端点

号，将其写入到保持寄存器 0xA1 中，然后再读取输入寄存器 0x31 获得该参数值，或写入到保

持寄存器 0xA2 以更新该参数值。

79

  江西伺泰威自动化设备有限公司

rev2.2

端点号是 16 位⽆符号整数。请下载所有参数和接口函数对应的端点号的 JSON 文件：

✓  版本 0.5.13：https://bl.cyberbeast.cn/actuator/endpoints_0.5.13.json

✓  版本 0.5.14：https://bl.cyberbeast.cn/actuator/endpoints_0.5.14.json

写入随机端点号请求：

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

电机响应：

2 字节

00 A1

2 字节

E0 E1

2 字节

XX XX

地址

功能码

寄存器地址

寄存器值

校验码

1 字节

1 字节

XX

06

2 字节

00 A1

2 字节

E0 E1

2 字节

XX XX

其中 E0 E1 为 16 位端点号从⾼到低的 2 个字节。

➢

➢

0xA2：随机端点访问写入值 1

0xA3：随机端点访问写入值 2

随机端点访问写入值为 32 位数，有可能是 16 位整数，32 位整数或 32 位浮点数，其中随

机端点访问写入值 1 为其⾼ 16 位，随机端点访问写入值 2 为其低 16 位。用户只能通过访问寄

存器地址 0xA2，同时写两个寄存器数据，从而更新端点值（参数值）。不可单独访问任何一个

寄存器。

写入请求：

地址  功能码  寄存器地址  寄存器个数  字节⻓度  寄存器值

校验码

1 字节

1 字节

2 字节

2 字节

1 字节

4 字节

2 字节

XX

10

00 A2

00 02

04

V0 V1 V2 V3

XX XX

电机响应：

地址

功能码

寄存器地址

寄存器个数

校验码

1 字节

1 字节

XX

10

2 字节

00 A2

2 字节

00 02

2 字节

XX XX

其中 V0 V1 V2 V3 为写入值的从⾼到低的 4 个字节，如果该端点是 32 位浮点数则按照 IEEE

754 标准进行编码（可通过网站 https://www.h-schmidt.net/FloatConverter/IEEE754.html 测试编

码）。

80

  江西伺泰威自动化设备有限公司

rev2.2

4.3.4 Modbus 协议实战

假设电机的地址是 1。

1)  实战：速度控制

发送帧的序列如下：

帧数据

寄存器

说明

01 06 00 64 00 02 XX XX

保持寄存器 0x64

设置控制模式为 2（速度控制）

01 06 00 65 00 02 XX XX

保持寄存器 0x65

设置输入模式为 2（速度斜坡）

01 06 00 63 00 08 XX XX

保持寄存器 0x63

将电机状态改变为 8（闭环运

行）。

01 10 00 68 00 02 04 40 13 33

保持寄存器 0x68

设置目标速度为 2.3r/s，转换为 32

33 XX XX

位浮点数为 40 13 33 33。

2)  实战：位置控制

发送帧的序列如下：

帧数据

寄存器

说明

01 06 00 64 00 03 XX XX

保持寄存器 0x64

设置控制模式为 3（位置控制）

01 06 00 65 00 03 XX XX

保持寄存器 0x65

设置输入模式为 3（位置滤波）

01 06 00 63 00 08 XX XX

保持寄存器 0x63

将电机状态改变为 8（闭环运

行）。

01 10 00 68 00 02 04 40 49 0F

保持寄存器 0x68

设置目标速度为 3.1416r，转换为

F9 XX XX

32 位浮点数为 40 49 0F F9。

4.4  PWM 输入控制

请确认硬件版本是 3.10 及以上版本再使用本功能。

此功能支持通过标准  RC PWM  信号（1ms–2ms  脉宽，50Hz）控制各类可写参数，如位

置、速度或力矩等。通过配置  GPIO  引脚为  PWM  模式，并设置映射关系，可实现从  RC  接

收机或其他  PWM  控制器对电机的直接控制。

81

  江西伺泰威自动化设备有限公司

rev2.2

4.4.1 接线说明

PWM  信号线连接⾄ 2.4.1 描述中 CANH 的位置，本接口支持 5V 及以下的 PWM 信号，需

要使 PWM 信号与电机驱动共地。

4.4.2  软件配置

➢  切换通信接口为 PWM：

odrv0.config.comm_intf_mux = 3

在电机精灵中，也可在通信参数中，切换物理接口，请点开电机参数中查找此项。

➢  设置  GPIO  为  PWM  模式

odrv0.config.gpio1_mode = GPIO_MODE_PWM

➢  设置 PWM 映射控制模式

可以映射为速度/位置/力矩模式，以下模式三者按需配置其一即可。

速度模式

请将电机控制模式设置为速度斜坡模式（control_mode = 2, input_mode = 2）

odrv0.config.gpio1_pwm_mapping.endpoint =

odrv0.axis0.controller._input_vel_property

  位置模式

请将电机控制模式设置为梯形曲线模式（control_mode = 3, input_mode = 5）

odrv0.config.gpio1_pwm_mapping.endpoint =

odrv0.axis0.controller._input_pos_property

力矩模式

82

  江西伺泰威自动化设备有限公司

rev2.2

请将电机控制模式设置为速度斜坡模式（control_mode = 1, input_mode = 6）

odrv0.config.gpio1_pwm_mapping.endpoint =

odrv0.axis0.controller._input_torque_property

➢  设置  PWM  映射参数

odrv0.config.gpio1_pwm_mapping.min = -8.0

odrv0.config.gpio1_pwm_mapping.max = 8.0

min  和  max  定义了  PWM  脉宽（1ms~2ms）映射到的控制量范围，驱动内部会将脉宽

值线性映射为  [min, max]  范围之间的实数值，然后写入你配置的  endpoint  控制目标值。min

和 max 可根据需求设置为任意值。

➢  保存配置（可选）

odrv0.save_configuration()

完成以上配置后，请使电机进入闭环即可进行 PWM 控制。

4.5  脉冲/方向控制

请确认硬件版本是 3.10 及以上版本再使用本功能，此功能与限位开关功能冲突。本功能是

控制驱动最简单的方法，但也是最原始、最脆弱的方法。因此，除⾮情况特殊，否则请勿使用

此控制方式。

本功能支持通过传统的  Step/Dir（脉冲/方向）接口来控制⽆刷电机，实现与普通步进电机

驱动器兼容的控制方式，此模式下：

Step（脉冲）信号：每一个上升沿对应电机移动一个预设的步距（由

steps_per_circular_range  决定），最大推荐  Step  频率：50kHz

Dir（方向）信号：电平决定运动方向（⾼电平顺时针  /  低电平逆时针）

4.5.1 接线说明

Step（脉冲信号）信号线连接⾄ 2.4.1 描述中 CANH 的位置，Dir（方向信号）信号线连接

⾄ 2.4.1 描述中 CANL 的位置，本接口支持 5V 及以下的脉冲信号，请确保  Step  和  Dir  信号与

电机驱动共地，否则信号可能识别失败。

4.5.2 软件配置

➢  切换通信接口为 Step/Dir：

odrv0.config.comm_intf_mux = 2

在电机精灵中，也可在通信参数中，切换物理接口，请点开电机参数中查找此项。

83

  江西伺泰威自动化设备有限公司

rev2.2

➢  设置  GPIO  为  Step/Dir  模式

odrv0.axis0.config.step_gpio_pin = 6

odrv0.axis0.config.dir_gpio_pin = 7

➢  配置  Step/Dir  引脚

odrv0.config.gpio6_mode = GPIO_MODE_DIGITAL_PULL_UP

odrv0.config.gpio7_mode = GPIO_MODE_DIGITAL_PULL_UP

➢  启用 Step/Dir

odrv0.axis0.config.enable_step_dir = True

请注意，要退出脉冲/方向控制，您需要将其设置 enable_step_dir 为 False，然后进

入空闲状态，再返回闭环控制。

➢  启用  Circular Setpoint（可选）

为处理大范围目标位置时的精度漂移问题，ODrive  提供  circular setpoint  支持，即目

标位置环绕模式，使用循环设定点可将浮点误差保持在可控范围内。如果电机被指令超出

循环范围，位置设定点将自动回绕以保持在范围内。

启用控制器的  circular setpoint  模式

odrv0.axis0.controller.config.circular_setpoints = True

设置圆形位置范围（单位：turns），设定点的取值会限制在 0~这个范围内，超出后

回绕

# 128 圈为一个闭环

odrv0.axis0.controller.config.circular_setpoint_range = 128.0

对应圆形位置范围内需要多少个  STEP  脉冲，决定  1 step  是多大位移量

 # 每圈 1024 个 step

odrv0.axis0.controller.config.steps_per_circular_range = 128 * 1024

84

  江西伺泰威自动化设备有限公司

rev2.2

➢

  保存配置（可选）

odrv0.save_configuration()

完成以上配置后，请使电机在位置模式下进入闭环即可进行 PWM 控制。

4.6  SDK

4.6.1 C/C++ SDK

基于 CAN Simple 协议，可下载下述 C/C++ SDK 进行集成：

https://gitee.com/cyberbeast/mwmotorsdk。请参照上述开源网站的详细测试实例进行集成测

试。

4.6.2 Python SDK

请首先参照 3.1 节步骤安装 odrivetool（pip install –upgrade odrive）。请参见 3.1.8，可利

用该小节描述的所有指令，来进行 python 开发。

下⾯是三个示例：

1)  实战：上电校准

import odrive

import time

odrv0 = odrive.find_any()

odrive.utils.dump_errors(odrv0)

odrv0.clear_errors()

odrv0.axis0.requested_state=odrive.utils.AxisState.MOTOR_CALIBRATION

time.sleep(5)

while (odrv0.axis0.current_state!=1):

  time.sleep(0.5)

odrive.utils.dump_errors(odrv0)

odrv0.axis0.requested_state=odrive.utils.AxisState.ENCODER_OFFSET_CALI

BRATION

time.sleep(6)

while (odrv0.axis0.current_state!=1):

  time.sleep(0.5)

odrive.utils.dump_errors(odrv0)

odrv0.axis0.motor.config.pre_calibrated=1

odrv0.axis0.encoder.config.pre_calibrated=1

odrv0.save_configuration()

85

  江西伺泰威自动化设备有限公司

rev2.2

2)  实战：速度控制

import odrive

import time

odrv0 = odrive.find_any()

odrv0.axis0.controller.config.control_mode=odrive.utils.ControlMode.VE

LOCITY_CONTROL

odrv0.axis0.controller.config.input_mode=odrive.utils.InputMode.VEL_RA

MP

odrv0.axis0.controller.config.vel_ramp_rate=50

odrv0.axis0.requested_state=odrive.utils.AxisState.CLOSED_LOOP_CONTROL

odrv0.axis0.controller.input_vel=15

odrive.utils.dump_errors(odrv0)

time.sleep(5)

odrv0.axis0.controller.input_vel=0

3)  实战：位置控制

import odrive

odrv0 = odrive.find_any()

odrv0.axis0.controller.config.control_mode=odrive.utils.ControlMode.PO

SITION_CONTROL

odrv0.axis0.controller.config.input_mode=odrive.utils.InputMode.POS_FI

LTER

odrv0.axis0.requested_state=odrive.utils.AxisState.CLOSED_LOOP_CONTROL

odrv0.axis0.controller.input_pos=10

4)  实战：数据采集

用户在研发集成过程中，经常需要采集电机运行的数据，⽐如采集电压电流变化，位置速

度变化等等，Python SDK 集成了强大的数据抓取能力，可以用简单的脚本实现海量运行数据抓

取，让研发和集成变得更加简单。

86

  江西伺泰威自动化设备有限公司

rev2.2

下⾯的代码是在上一个位置控制实例的基础上，增加了实时位置和电流数据抓取的功能，

并将数据保存成一个 csv 文件。

import odrive

import numpy as np

odrv0 = odrive.find_any()

cap =

odrive.utils.BulkCapture(lambda:[odrv0.axis0.motor.current_control.Iq_

measured,odrv0.axis0.encoder.pos_estimate],data_rate=500,duration=2.5)

odrv0.axis0.controller.config.control_mode=odrive.utils.ControlMode.PO

SITION_CONTROL

odrv0.axis0.controller.config.input_mode=odrive.utils.InputMode.POS_FI

LTER

odrv0.axis0.requested_state=odrive.utils.AxisState.CLOSED_LOOP_CONTROL

odrv0.axis0.controller.input_pos=10

np.savetxt("d:/test.csv",cap.data,delimiter=',')

其中进行 BulkCapture 的语句中，data_rate 代表采样频率，单位是 hz，duration 代表采样

时间，单位是秒，其中的 lambda 表达式可以插入任何的数学运算，以方便数据分析。

4.6.3 Arduino SDK

用户使用 Arduino 可通过 CAN 总线来控制电机，底层协议如 4.1 中描述。可兼容硬件/

库：

✓  内置有 CAN 接口的 Arduino，如 Arduino UNO R4 Minima，Arduino UNO R4 WIFI 等

✓  内置 CAN 接口的 Teensy 开发板可使用适配的 FlexCAN_T4 库（Teensy 4.0 和 Teensy

4.1）进行访问

✓  其他 Arduino 兼容的板可使用基于 MCP2515 的 CAN 扩展板进行访问

下⾯是一个示例，展示如何配置电机响应 Arduino 的位置控制指令：

➢  配置电机

除了 3.1.3 的基础配置外，将控制配置成控制带宽为 20rad/s（Arduino Uno 的发送速度受

限，所以控制带宽不用太⾼，如果用更快的 Arduino，可提⾼此带宽值）：

➢  配置 CAN

按照下述方法配置 CAN：

➢  安装 ODriveArduino 库

按照下述步骤安装 OdriveArduino 库（假设用户已经安装 Arduino IDE）：

1)  打开 Arduino IDE

87

  江西伺泰威自动化设备有限公司

rev2.2

2)

Sketch -> Include Library -> Manage Libraries

3)  输入”ODriveArduino”进行搜索

4)  点击搜索到的 ODriveArduino 库进行安装

➢  Arduino 源码

#include <Arduino.h>

#include "ODriveCAN.h"

// Documentation for this example can be found here:

// https://docs.odriverobotics.com/v/latest/guides/arduino-can-guide.html

/* Configuration of example sketch -------------------------------------------*/

// CAN bus baudrate. Make sure this matches for every device on the bus

#define CAN_BAUDRATE 500000

// ODrive node_id for odrv0

#define ODRV0_NODE_ID 0

// Uncomment below the line that corresponds to your hardware.

// See also "Board-specific settings" to adapt the details for your hardware

setup.

// #define IS_TEENSY_BUILTIN // Teensy boards with built-in CAN interface (e.g.

Teensy 4.1). See below to select which interface to use.

// #define IS_ARDUINO_BUILTIN // Arduino boards with built-in CAN interface (e.g.

Arduino Uno R4 Minima)

// #define IS_MCP2515 // Any board with external MCP2515 based extension module.

See below to configure the module.

/* Board-specific includes ---------------------------------------------------*/

#if defined(IS_TEENSY_BUILTIN) + defined(IS_ARDUINO_BUILTIN) +

defined(IS_MCP2515) != 1

#warning "Select exactly one hardware option at the top of this file."

#if CAN_HOWMANY > 0 || CANFD_HOWMANY > 0

#define IS_ARDUINO_BUILTIN

#warning "guessing that this uses HardwareCAN"

#else

#error "cannot guess hardware version"

88

  江西伺泰威自动化设备有限公司

rev2.2

#endif

#endif

#ifdef IS_ARDUINO_BUILTIN

// See https://github.com/arduino/ArduinoCore-API/blob/master/api/HardwareCAN.h

// and https://github.com/arduino/ArduinoCore-

renesas/tree/main/libraries/Arduino_CAN

#include <Arduino_CAN.h>

#include <ODriveHardwareCAN.hpp>

#endif // IS_ARDUINO_BUILTIN

#ifdef IS_MCP2515

// See https://github.com/sandeepmistry/arduino-CAN/

#include "MCP2515.h"

#include "ODriveMCPCAN.hpp"

#endif // IS_MCP2515

#ifdef IS_TEENSY_BUILTIN

// See https://github.com/tonton81/FlexCAN_T4

// clone https://github.com/tonton81/FlexCAN_T4.git into /src

#include <FlexCAN_T4.h>

#include "ODriveFlexCAN.hpp"

struct ODriveStatus; // hack to prevent teensy compile error

#endif // IS_TEENSY_BUILTIN

/* Board-specific settings ---------------------------------------------------*/

/* Teensy */

#ifdef IS_TEENSY_BUILTIN

FlexCAN_T4<CAN1, RX_SIZE_256, TX_SIZE_16> can_intf;

bool setupCan() {

  can_intf.begin();

  can_intf.setBaudRate(CAN_BAUDRATE);

  can_intf.setMaxMB(16);

  can_intf.enableFIFO();

89

  江西伺泰威自动化设备有限公司

rev2.2

  can_intf.enableFIFOInterrupt();

  can_intf.onReceive(onCanMessage);

  return true;

}

#endif // IS_TEENSY_BUILTIN

/* MCP2515-based extension modules -*/

#ifdef IS_MCP2515

MCP2515Class& can_intf = CAN;

// chip select pin used for the MCP2515

#define MCP2515_CS 10

// interrupt pin used for the MCP2515

// NOTE: not all Arduino pins are interruptable, check the documentation for your

board!

#define MCP2515_INT 2

// freqeuncy of the crystal oscillator on the MCP2515 breakout board.

// common values are: 16 MHz, 12 MHz, 8 MHz

#define MCP2515_CLK_HZ 8000000

static inline void receiveCallback(int packet_size) {

  if (packet_size > 8) {

    return; // not supported

  }

  CanMsg msg = {.id = (unsigned int)CAN.packetId(), .len = (uint8_t)packet_size};

  CAN.readBytes(msg.buffer, packet_size);

  onCanMessage(msg);

}

bool setupCan() {

  // configure and initialize the CAN bus interface

  CAN.setPins(MCP2515_CS, MCP2515_INT);

  CAN.setClockFrequency(MCP2515_CLK_HZ);

  if (!CAN.begin(CAN_BAUDRATE)) {

    return false;

  }

90

  江西伺泰威自动化设备有限公司

rev2.2

  CAN.onReceive(receiveCallback);

  return true;

}

#endif // IS_MCP2515

/* Arduinos with built-in CAN */

#ifdef IS_ARDUINO_BUILTIN

HardwareCAN& can_intf = CAN;

bool setupCan() {

  return can_intf.begin((CanBitRate)CAN_BAUDRATE);

}

#endif

/* Example sketch ------------------------------------------------------------*/

// Instantiate ODrive objects

ODriveCAN odrv0(wrap_can_intf(can_intf), ODRV0_NODE_ID); // Standard CAN message

ID

ODriveCAN* odrives[] = {&odrv0}; // Make sure all ODriveCAN instances are

accounted for here

struct ODriveUserData {

  Heartbeat_msg_t last_heartbeat;

  bool received_heartbeat = false;

  Get_Encoder_Estimates_msg_t last_feedback;

  bool received_feedback = false;

};

// Keep some application-specific user data for every ODrive.

ODriveUserData odrv0_user_data;

// Called every time a Heartbeat message arrives from the ODrive

void onHeartbeat(Heartbeat_msg_t& msg, void* user_data) {

  ODriveUserData* odrv_user_data = static_cast<ODriveUserData*>(user_data);

  odrv_user_data->last_heartbeat = msg;

  odrv_user_data->received_heartbeat = true;

}

91

  江西伺泰威自动化设备有限公司

rev2.2

// Called every time a feedback message arrives from the ODrive

void onFeedback(Get_Encoder_Estimates_msg_t& msg, void* user_data) {

  ODriveUserData* odrv_user_data = static_cast<ODriveUserData*>(user_data);

  odrv_user_data->last_feedback = msg;

  odrv_user_data->received_feedback = true;

}

// Called for every message that arrives on the CAN bus

void onCanMessage(const CanMsg& msg) {

  for (auto odrive: odrives) {

    onReceive(msg, *odrive);

  }

}

void setup() {

  Serial.begin(115200);

  // Wait for up to 3 seconds for the serial port to be opened on the PC side.

  // If no PC connects, continue anyway.

  for (int i = 0; i < 30 && !Serial; ++i) {

    delay(100);

  }

  delay(200);

  Serial.println("Starting ODriveCAN demo");

  // Register callbacks for the heartbeat and encoder feedback messages

  odrv0.onFeedback(onFeedback, &odrv0_user_data);

  odrv0.onStatus(onHeartbeat, &odrv0_user_data);

  // Configure and initialize the CAN bus interface. This function depends on

  // your hardware and the CAN stack that you're using.

  if (!setupCan()) {

    Serial.println("CAN failed to initialize: reset required");

    while (true); // spin indefinitely

  }

  Serial.println("Waiting for ODrive...");

  while (!odrv0_user_data.received_heartbeat) {

    pumpEvents(can_intf);

    delay(100);

  }

92

  江西伺泰威自动化设备有限公司

rev2.2

  Serial.println("found ODrive");

  // request bus voltage and current (1sec timeout)

  Serial.println("attempting to read bus voltage and current");

  Get_Bus_Voltage_Current_msg_t vbus;

  if (!odrv0.request(vbus, 1)) {

    Serial.println("vbus request failed!");

    while (true); // spin indefinitely

  }

  Serial.print("DC voltage [V]: ");

  Serial.println(vbus.Bus_Voltage);

  Serial.print("DC current [A]: ");

  Serial.println(vbus.Bus_Current);

  Serial.println("Enabling closed loop control...");

  while (odrv0_user_data.last_heartbeat.Axis_State !=

ODriveAxisState::AXIS_STATE_CLOSED_LOOP_CONTROL) {

    odrv0.clearErrors();

    delay(1);

    odrv0.setState(ODriveAxisState::AXIS_STATE_CLOSED_LOOP_CONTROL);

    // Pump events for 150ms. This delay is needed for two reasons;

    // 1. If there is an error condition, such as missing DC power, the ODrive

might

    //    briefly attempt to enter CLOSED_LOOP_CONTROL state, so we can't rely

    //    on the first heartbeat response, so we want to receive at least two

    //    heartbeats (100ms default interval).

    // 2. If the bus is congested, the setState command won't get through

    //    immediately but can be delayed.

    for (int i = 0; i < 15; ++i) {

      delay(10);

      pumpEvents(can_intf);

    }

  }

  Serial.println("ODrive running!");

}

void loop() {

  pumpEvents(can_intf); // This is required on some platforms to handle incoming

feedback CAN messages

93

  江西伺泰威自动化设备有限公司

rev2.2

  float SINE_PERIOD = 2.0f; // Period of the position command sine wave in

seconds

  float t = 0.001 * millis();

  float phase = t * (TWO_PI / SINE_PERIOD);

  odrv0.setPosition(

    sin(phase), // position

    cos(phase) * (TWO_PI / SINE_PERIOD) // velocity feedforward (optional)

  );

  // print position and velocity for Serial Plotter

  if (odrv0_user_data.received_feedback) {

    Get_Encoder_Estimates_msg_t feedback = odrv0_user_data.last_feedback;

    odrv0_user_data.received_feedback = false;

    Serial.print("odrv0-pos:");

    Serial.print(feedback.Pos_Estimate);

    Serial.print(",");

    Serial.print("odrv0-vel:");

    Serial.println(feedback.Vel_Estimate);

  }

}

4.6.4 ROS SDK

以下步骤在 Ubuntu 23.04 和 ROS2 Iron 上经过测试验证，但不支持 MAC 和 Windows 平

台，且在其他 ROS2 版本上未验证，需要经过修正后才可使用。

4.6.4.1 安装 odrive_can 包

1.  新建一个 ROS2 workspace（请参见 https://docs.ros.org/en/iron/index.html）

2.  用 git clone https://github.com/odriverobotics/odrive_can 将代码下载到上述

workspace 目录中的 src 目录

3.  在 terminal 中转到 workspace 的根目录，并运行：

colcon build --packages-select odrive_can

4.  运行之前的环境准备：

source ./install/setup.bash

94

  江西伺泰威自动化设备有限公司

rev2.2

5.  运行例程节点：

ros2 launch odrive_can example_launch.yaml

4.6.4.2 调用服务和查看消息

假设上述 odrive_can_node 节点运行于命名空间 odrive_axis0（可

在./launch/example_launch.yaml 中设置）。一旦 4.4.4.1 中的节点运行起来过后，就可以查看所

公布的话题消息，如：

ros2 topic echo /odrive_axis0/controller_status

ros2 topic echo /odrive_axis0/odrive_status

并调用开放的服务接口，如下述调用可开始进行电机校准：

ros2 service call /odrive_axis0/request_axis_state

/odrive_can/srv/AxisState "{axis_requested_state: 4}"

5  常见问题和异常码（待更新）

5.6  常见问题（FAQ）

5.7  异常码

错误

错误码

odrivetool 显示

描述

类别

系统

0x00000002  DC_BUS_UNDER_VOLTAGE

异常

0x00000004  DC_BUS_OVER_VOLTAGE

电源电压过低

电源电压过⾼

0x00000008  DC_BUS_OVER_REGEN_CURRENT

电源反向（充电）电流过

0x00000010  DC_BUS_OVER_CURRENT

电源正向（放电）电流过

⾼

驱动

0x00000001

INVALID_STATE

异常

0x00000040  MOTOR_FAILED

0x00000100

ENCODER_FAILED

0x00000200

CONTROLLER_FAILED

0x00001000  MIN_ENDSTOP_PRESSED

0x00002000  MAX_ENDSTOP_PRESSED

0x00004000

ESTOP_REQUESTED

⾼

驱动器状态错误

电机异常

编码器异常

控制器异常

低限位触发

⾼限位触发

紧急停止

0x00020000  HOMING_WITHOUT_ENDSTOP

回零但没有限位开关

0x00080000  UNKNOWN_POSITION

⽆位置信息

0x00000001

PHASE_RESISTANCE_OUT_OF_RANGE

相间电阻超出正常范围

95

  江西伺泰威自动化设备有限公司

rev2.2

电机

0x00000002

PHASE_INDUCTANCE_OUT_OF_RANGE

相间电感超出正常范围

异常

0x00000010

CONTROL_DEADLINE_MISSED

0x00000080  MODULATION_MAGNITUDE

0x00000400

CURRENT_SENSE_SATURATION

0x00001000

CURRENT_LIMIT_VIOLATION

FOC 频率太⾼

SVM 调制异常

相电流饱和

电机电流过大

0x00020000  MOTOR_THERMISTOR_OVER_TEMP

电机温度过⾼

0x00040000

FET_THERMISTOR_OVER_TEMP

0x00080000

TIMER_UPDATE_MISSED

驱动器温度过⾼

FOC 处理不及时

0x00100000

CURRENT_MEASUREMENT_UNAVAILABLE  相电流采样丢失

0x00200000

CONTROLLER_FAILED

0x00400000

I_BUS_OUT_OF_RANGE

控制异常

母线电流超限

0x00800000

BRAKE_RESISTOR_DISARMED

刹车电阻驱动异常

0x01000000

SYSTEM_LEVEL

0x02000000

BAD_TIMING

0x04000000  UNKNOWN_PHASE_ESTIMATE

0x08000000  UNKNOWN_PHASE_VEL

0x10000000  UNKNOWN_TORQUE

系统级异常

相电流采样不及时

电机位置未知

电机速度未知

力矩未知

0x20000000  UNKNOWN_CURRENT_COMMAND

力矩控制未知

0x40000000  UNKNOWN_CURRENT_MEASUREMENT  电流采样值未知

0x80000000  UNKNOWN_VBUS_VOLTAGE

电压采样值未知

0x100000000  UNKNOWN_VOLTAGE_COMMAND

电压控制未知

0x200000000  UNKNOWN_GAINS

0x400000000  CONTROLLER_INITIALIZING

0x800000000  UNBALANCED_PHASES

控制

0x00000001  OVERSPEED

电流环增益未知

控制器初始化异常

三相不平衡

速度过⾼

异常

0x00000002

INVALID_INPUT_MODE

控制输入模式不正确

0x00000004  UNSTABLE_GAIN

0x00000020

INVALID_ESTIMATE

0x00000080

SPINOUT_DETECTED

0x00000001  UNSTABLE_GAIN

锁相环增益不稳

位置/速度不稳定

机械功率和电气功率不匹

配（编码器校准不正确，

或磁钢不稳）

编码器带宽过⾼

0x00000002

CPR_POLEPAIRE_MISMATCH

CPR 和极对数不匹配

0x00000004  NO_RESPONSE

0x00000400

SEC_ENC_COM_FAIL

编码器⽆响应

第二编码器通信错误

编码

器异

常

96


